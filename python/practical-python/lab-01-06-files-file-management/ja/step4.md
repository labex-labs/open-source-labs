# 演習1.26: ファイルの基礎

まず、大きな文字列としてファイル全体を一度に読み取ってみましょう。

```python
>>> with open('portfolio.csv', 'rt') as f:
        data = f.read()

>>> data
'name,shares,price\n"AA",100,32.20\n"IBM",50,91.10\n"CAT",150,83.44\n"MSFT",200,51.23\n"GE",95,40.37\n"MSFT",50,65.10\n"IBM",100,70.44\n'
>>> print(data)
name,shares,price
"AA",100,32.20
"IBM",50,91.10
"CAT",150,83.44
"MSFT",200,51.23
"GE",95,40.37
"MSFT",50,65.10
"IBM",100,70.44
>>>
```

上記の例では、Pythonには2つの出力モードがあることに注意してください。プロンプトで `data` を入力する最初のモードでは、Pythonは引用符やエスケープコードを含む生の文字列の表現を表示します。`print(data)` を入力すると、文字列の実際のフォーマット済み出力が得られます。

ファイルを一度に読み取ることは簡単ですが、それが最適な方法であるとは限りません。特に、ファイルが非常に大きい場合や、1行ずつ処理したいテキストの行が含まれている場合には、そうです。

ファイルを1行ずつ読み取るには、次のようにforループを使用します。

```python
>>> with open('portfolio.csv', 'rt') as f:
        for line in f:
            print(line, end='')

name,shares,price
"AA",100,32.20
"IBM",50,91.10
...
>>>
```

このコードを示すように使用すると、ファイルの終端に達するまで行が読み取られ、その時点でループが停止します。

特定の場合、1行のテキストを手動で読み取ったり、スキップしたりしたい場合があります（たとえば、列見出しの最初の行をスキップしたい場合）。

```python
>>> f = open('portfolio.csv', 'rt')
>>> headers = next(f)
>>> headers
'name,shares,price\n'
>>> for line in f:
    print(line, end='')

"AA",100,32.20
"IBM",50,91.10
...
>>> f.close()
>>>
```

`next()` は、ファイル内の次のテキスト行を返します。何度も呼び出すと、連続した行が得られます。ただし、ご存知のように、`for` ループはすでにデータを取得するために `next()` を使用しています。したがって、明示的に1行をスキップしたり読み取ったりする場合を除き、通常は直接呼び出すことはありません。

ファイルの行を読み取り始めると、分割などのさらなる処理を行うことができます。たとえば、次のように試してみてください。

```python
>>> f = open('portfolio.csv', 'rt')
>>> headers = next(f).split(',')
>>> headers
['name','shares', 'price\n']
>>> for line in f:
    row = line.split(',')
    print(row)

['"AA"', '100', '32.20\n']
['"IBM"', '50', '91.10\n']
...
>>> f.close()
```

_注: これらの例では、`with` ステートメントを使用していないため、明示的に `f.close()` が呼び出されています。_
