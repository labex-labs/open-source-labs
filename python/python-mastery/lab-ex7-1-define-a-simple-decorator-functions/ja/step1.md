# 最初のデコレータを作成する

## デコレータとは何か？

Python では、デコレータ (Decorator) は初心者にとって非常に便利な特殊な構文です。デコレータを使うと、関数やメソッドの動作を変更することができます。デコレータは、別の関数を入力として受け取り、新しい関数を返す関数と考えることができます。この新しい関数は、元の関数の動作を拡張または変更することが多いです。

デコレータは `@` 記号を使って適用されます。この記号の後にデコレータ名を付け、関数定義の直上に配置します。これは、特定の関数にデコレータを適用したいことを Python に伝える簡単な方法です。

## 単純なロギングデコレータを作成する

関数が呼び出されたときに情報をログに記録する単純なデコレータを作成しましょう。ロギングは実世界のアプリケーションで一般的なタスクであり、これにデコレータを使用することは、デコレータの動作を理解するための素晴らしい方法です。

1. まず、VSCode エディタを開きます。`/home/labex/project` ディレクトリに `logcall.py` という名前の新しいファイルを作成します。このファイルには、デコレータ関数を記述します。

2. `logcall.py` に以下のコードを追加します。

```python
# logcall.py

def logged(func):
    print('Adding logging to', func.__name__)
    def wrapper(*args, **kwargs):
        print('Calling', func.__name__)
        return func(*args, **kwargs)
    return wrapper
```

このコードが何をするかを分解してみましょう。

- `logged` 関数がデコレータです。この関数は、別の関数（ここでは `func` と呼ぶ）を引数として受け取ります。この `func` は、ロギングを追加したい関数です。
- デコレータが関数に適用されると、メッセージが表示されます。このメッセージは、指定された名前の関数にロギングが追加されることを示します。
- `logged` 関数の内部で、`wrapper` という内部関数を定義しています。この `wrapper` 関数が元の関数の代わりになります。
  - デコレートされた関数が呼び出されると、`wrapper` 関数は関数が呼び出されていることを示すメッセージを表示します。
  - その後、元の関数 (`func`) を、渡されたすべての引数で呼び出します。`*args` と `**kwargs` は、任意の数の位置引数とキーワード引数を受け取るために使用されます。
  - 最後に、元の関数の結果を返します。
- `logged` 関数は `wrapper` 関数を返します。この `wrapper` 関数が、ロギング機能を追加した状態で、元の関数の代わりに使用されます。

## デコレータを使用する

3. 次に、同じディレクトリ (`/home/labex/project`) に、`sample.py` という名前の別のファイルを作成し、以下のコードを記述します。

```python
# sample.py

from logcall import logged

@logged
def add(x, y):
    return x + y

@logged
def sub(x, y):
    return x - y
```

ここで `@logged` 構文は非常に重要です。これは、`add` 関数と `sub` 関数に `logged` デコレータを適用することを Python に指示します。したがって、これらの関数が呼び出されるたびに、デコレータによって追加されたロギング機能が実行されます。

## デコレータをテストする

4. デコレータをテストするには、VSCode でターミナルを開きます。まず、以下のコマンドを使用してプロジェクトディレクトリに移動します。

```bash
cd /home/labex/project
```

次に、Python インタープリターを起動します。

```bash
python3
```

5. Python インタープリターで、`sample` モジュールをインポートし、デコレートされた関数をテストします。

```python
>>> import sample
Adding logging to add
Adding logging to sub
>>> sample.add(3, 4)
Calling add
7
>>> sample.sub(2, 3)
Calling sub
-1
>>> exit()
```

`sample` モジュールをインポートすると、「Adding logging to...」というメッセージが表示されることに注意してください。これは、モジュールがインポートされるときにデコレータが適用されるためです。デコレートされた関数を呼び出すたびに、「Calling...」というメッセージが表示されます。これは、デコレータが期待通りに動作していることを示しています。

この単純なデコレータは、デコレータの基本的な概念を示しています。元の関数のコードを変更することなく、追加の機能（この場合はロギング）を元の関数にラップします。これは、Python の強力な機能であり、さまざまなシナリオで使用することができます。
