# Базовый конвейер генераторов с данными в формате CSV

На этом этапе мы научимся создавать базовый конвейер обработки данных с использованием генераторов. Но сначала разберемся, что такое генераторы. Генераторы - это особый тип итераторов в Python. В отличие от обычных итераторов, которые могут загрузить все данные в память сразу, генераторы создают значения по запросу. Это чрезвычайно полезно при работе с большими потоками данных, так как экономит память. Вместо того чтобы хранить весь набор данных в памяти, генератор создает значения по одному по мере необходимости.

## Понимание генераторов

Генератор по сути представляет собой функцию, которая возвращает итератор. Когда вы итерируете по этому итератору, он создает последовательность значений. Запись функции - генератора похожа на запись обычной функции, но есть важное различие. Вместо оператора `return` функция - генератор использует оператор `yield`. Оператор `yield` имеет уникальное поведение. Он приостанавливает функцию и сохраняет ее текущее состояние. Когда запрашивается следующее значение, функция продолжает работу с того места, где остановилась. Это позволяет генератору создавать значения пошагово, не требуя каждый раз начинать с начала.

## Использование функции `follow()`

Функция `follow()`, которую вы создали ранее, работает аналогично команде Unix `tail -f`. Команда `tail -f` постоянно отслеживает файл на предмет появления нового содержимого, и то же делает функция `follow()`. Теперь используем ее для создания простого конвейера обработки данных.

### Шаг 1: Откройте новое окно терминала

Сначала откройте новое окно терминала в WebIDE. Вы можете сделать это, выбрав `Terminal → New Terminal`. В этом новом терминале мы будем запускать наши команды Python.

### Шаг 2: Запустите интерактивную оболочку Python

После открытия нового терминала запустите интерактивную оболочку Python. Вы можете сделать это, введя следующую команду в терминале:

```bash
python3
```

Интерактивная оболочка Python позволяет запускать код Python построчно и сразу видеть результаты.

### Шаг 3: Импортируйте функцию `follow` и настройте конвейер

Теперь импортируем функцию `follow` и настроим базовый конвейер для чтения данных о ценах на акции. В интерактивной оболочке Python введите следующий код:

```python
>>> from follow import follow
>>> import csv
>>> lines = follow('stocklog.csv')
>>> rows = csv.reader(lines)
>>> for row in rows:
...     print(row)
...
```

Вот что делает каждая строка:

- `from follow import follow`: Эта строка импортирует функцию `follow` из модуля `follow`.
- `import csv`: Эта строка импортирует модуль `csv`, который используется для чтения и записи файлов в формате CSV в Python.
- `lines = follow('stocklog.csv')`: Эта строка вызывает функцию `follow` с именем файла `stocklog.csv`. Функция `follow` возвращает генератор, который выдает новые строки по мере их добавления в файл.
- `rows = csv.reader(lines)`: Функция `csv.reader()` принимает строки, сгенерированные функцией `follow`, и разбирает их на строки данных в формате CSV.
- Цикл `for` проходит по этим строкам и выводит каждую из них.

### Шаг 4: Проверьте вывод

После выполнения кода вы должны увидеть вывод, похожий на следующий (ваши данные могут отличаться):

```
['BA', '98.35', '6/11/2007', '09:41.07', '0.16', '98.25', '98.35', '98.31', '158148']
['AA', '39.63', '6/11/2007', '09:41.07', '-0.03', '39.67', '39.63', '39.31', '270224']
['XOM', '82.45', '6/11/2007', '09:41.07', '-0.23', '82.68', '82.64', '82.41', '748062']
['PG', '62.95', '6/11/2007', '09:41.08', '-0.12', '62.80', '62.97', '62.61', '454327']
...
```

Этот вывод показывает, что вы успешно создали конвейер обработки данных. Функция `follow()` генерирует строки из файла, а затем эти строки передаются функции `csv.reader()`, которая разбирает их на строки данных.

Если вы видите достаточно вывода, вы можете остановить выполнение, нажав `Ctrl+C`.

## Что происходит?

Разберем, что происходит в этом конвейере:

1. `follow('stocklog.csv')` создает генератор. Этот генератор отслеживает файл `stocklog.csv` и выдает новые строки по мере их добавления в файл.
2. `csv.reader(lines)` принимает строки, сгенерированные функцией `follow`, и разбирает их на строки данных в формате CSV. Он понимает структуру файлов в формате CSV и разделяет строки на отдельные значения.
3. Затем цикл `for` проходит по этим строкам, выводя каждую из них. Это позволяет вам видеть данные в удобочитаемом формате.

Это простой пример конвейера обработки данных с использованием генераторов. В следующих шагах мы создадим более сложные и полезные конвейеры.
