# Ticker クラスの作成

データ処理において、生データを扱うことはかなり難しい場合があります。株式データの処理をより整理されたものにし、効率的に行うために、株式相場を表す適切なクラスを定義します。このクラスは株式データの設計図として機能し、データ処理パイプラインをより堅牢で管理しやすいものにします。

## ticker.py ファイルの作成

1. まず、WebIDE で新しいファイルを作成する必要があります。「New File」アイコンをクリックするか、ファイルエクスプローラーで右クリックして「New File」を選択することができます。このファイルに `ticker.py` という名前を付けます。このファイルには `Ticker` クラスのコードが記述されます。

2. 次に、新しく作成した `ticker.py` ファイルに以下のコードを追加します。このコードは `Ticker` クラスを定義し、それをテストするための簡単な処理パイプラインを設定します。

```python
# ticker.py

from structure import Structure, String, Float, Integer

class Ticker(Structure):
    name = String()
    price = Float()
    date = String()
    time = String()
    change = Float()
    open = Float()
    high = Float()
    low = Float()
    volume = Integer()

if __name__ == '__main__':
    from follow import follow
    import csv
    lines = follow('stocklog.csv')
    rows = csv.reader(lines)
    records = (Ticker.from_row(row) for row in rows)
    for record in records:
        print(record)
```

3. コードを追加したら、ファイルを保存します。`Ctrl+S` を押すか、メニューから「File」→「Save」を選択することができます。ファイルを保存することで、変更内容が保存され、後で実行することができます。

## コードの理解

このコードがどのように動作するかを詳しく見ていきましょう。

1. コードの最初では、`structure.py` モジュールから `Structure` とフィールドタイプをインポートしています。このモジュールはすでに設定されています。これらのインポートは、`Ticker` クラスの構成要素を提供するために不可欠です。`Structure` クラスは `Ticker` クラスの基底クラスとなり、`String`、`Float`、`Integer` などのフィールドタイプは株式データのフィールドのデータ型を定義します。

2. 次に、`Structure` を継承する `Ticker` クラスを定義します。このクラスには、株式データのさまざまな側面を表すいくつかのフィールドがあります。

   - `name`: このフィールドは株式シンボル（例えば「IBM」や「AAPL」）を格納します。どの会社の株式を扱っているかを識別するのに役立ちます。
   - `price`: このフィールドは株式の現在の価格を保持します。これは投資家にとって重要な情報です。
   - `date` と `time`: これらのフィールドは株式相場が生成された日時を示します。日時を知ることは、株価のトレンドを経時的に分析するために重要です。
   - `change`: このフィールドは株価の変動を表します。前の時点と比較して株価が上がったか下がったかを示します。
   - `open`、`high`、`low`: これらのフィールドは、ある期間内の株式の始値、最高値、最低値を表します。株価の範囲を把握するのに役立ちます。
   - `volume`: このフィールドは取引された株式数を格納します。高い取引量は、特定の株式に対する強い市場関心を示すことがあります。

3. `if __name__ == '__main__':` ブロックでは、処理パイプラインを設定しています。このコードブロックは、`ticker.py` ファイルを直接実行したときに実行されます。
   - `follow('stocklog.csv')` は、`stocklog.csv` ファイルから行を生成する関数です。ファイルを 1 行ずつ読み取ることができます。
   - `csv.reader(lines)` はこれらの行を受け取り、行データに解析します。CSV（Comma - Separated Values）は表形式のデータを格納するための一般的なファイル形式で、この関数は各行からデータを抽出するのに役立ちます。
   - `(Ticker.from_row(row) for row in rows)` はジェネレータ式です。各行のデータを取り、それを `Ticker` オブジェクトに変換します。これにより、生の CSV データを操作しやすい構造化されたオブジェクトに変換することができます。
   - `for` ループはこれらの `Ticker` オブジェクトを反復処理し、それぞれを出力します。これにより、構造化されたデータが実際に動作する様子を確認することができます。

## コードの実行

コードがどのように動作するかを確認するために、実行してみましょう。

1. まず、ターミナルでプロジェクトディレクトリにいることを確認する必要があります。まだそこにいない場合は、以下のコマンドを使用して移動します。

   ```bash
   cd /home/labex/project
   ```

2. 正しいディレクトリにいることを確認したら、以下のコマンドを使用して `ticker.py` スクリプトを実行します。

   ```bash
   python3 ticker.py
   ```

3. スクリプトを実行した後、以下のような出力が表示されるはずです（データは異なる場合があります）。
   ```
   Ticker(IBM, 103.53, 6/11/2007, 09:53.59, 0.46, 102.87, 103.53, 102.77, 541633)
   Ticker(MSFT, 30.21, 6/11/2007, 09:54.01, 0.16, 30.05, 30.21, 29.95, 7562516)
   Ticker(AA, 40.01, 6/11/2007, 09:54.01, 0.35, 39.67, 40.15, 39.31, 576619)
   Ticker(T, 40.1, 6/11/2007, 09:54.08, -0.16, 40.2, 40.19, 39.87, 1312959)
   ```

出力を十分に確認したら、`Ctrl+C` を押してスクリプトの実行を停止することができます。

生の CSV データが構造化された `Ticker` オブジェクトに変換されたことに注目してください。この変換により、`Ticker` クラスで定義されたフィールドを使用して株式データにアクセスし、操作することができるため、処理パイプラインでのデータの操作がはるかに容易になります。
