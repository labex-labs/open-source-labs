# Переписывание класса Stock

Теперь, когда у нас есть хорошо определенный базовый класс `Structure`, пришло время переписать наш класс `Stock`. Используя этот базовый класс, мы можем упростить наш код и сделать его более организованным. Класс `Structure` предоставляет набор общих функций, которые мы можем повторно использовать в нашем классе `Stock`, что является большим преимуществом для поддерживаемости и читаемости кода.

## Создание нового класса Stock

Начнем с создания нового файла с именем `stock.py`. Этот файл будет содержать наш переписанный класс `Stock`. Вот код, который нужно поместить в файл `stock.py`:

```python
# stock.py
from structure import Structure

class Stock(Structure):
    _fields = ('name', 'shares', 'price')

    @property
    def cost(self):
        """
        Calculate the cost as shares * price
        """
        return self.shares * self.price

    def sell(self, nshares):
        """
        Sell a number of shares
        """
        self.shares -= nshares
```

Разберем, что делает этот новый класс `Stock`:

1. Он наследуется от класса `Structure`. Это означает, что класс `Stock` может использовать все функции, предоставляемые классом `Structure`. Одно из преимуществ заключается в том, что нам не нужно самостоятельно писать метод `__init__`, так как класс `Structure` автоматически обрабатывает назначение атрибутов.
2. Мы определяем `_fields`, который представляет собой кортеж, указывающий атрибуты класса `Stock`. Эти атрибуты - `name`, `shares` и `price`.
3. Определено свойство `cost` для вычисления общей стоимости акций. Оно умножает количество `shares` на `price`.
4. Метод `sell` используется для уменьшения количества акций. Когда вы вызываете этот метод с количеством акций для продажи, он вычитает это количество из текущего количества акций.

## Тестирование нового класса Stock

Чтобы убедиться, что наш новый класс `Stock` работает как ожидается, нам нужно создать тестовый файл. Создадим файл с именем `test_stock.py` со следующим кодом:

```python
# test_stock.py
from stock import Stock

# Create a stock
s = Stock('GOOG', 100, 490.1)

# Check the attributes
print(f"Stock: {s}")
print(f"Name: {s.name}")
print(f"Shares: {s.shares}")
print(f"Price: {s.price}")
print(f"Cost: {s.cost}")

# Sell some shares
print("\nSelling 20 shares...")
s.sell(20)
print(f"Shares after selling: {s.shares}")
print(f"Cost after selling: {s.cost}")

# Try to set an invalid attribute
print("\nTrying to set an invalid attribute:")
try:
    s.prices = 500  # Invalid attribute (should be 'price')
    print("This should not print")
except AttributeError as e:
    print(f"Error correctly caught: {e}")
```

В этом тестовом файле мы сначала импортируем класс `Stock` из файла `stock.py`. Затем создаем экземпляр класса `Stock` с именем 'GOOG', 100 акциями и ценой 490.1. Мы выводим на экран атрибуты акции, чтобы проверить, правильно ли они заданы. Затем мы продаем 20 акций и выводим новое количество акций и новую стоимость. Наконец, мы пытаемся установить недопустимый атрибут `prices` (должно быть `price`). Если наш класс `Stock` работает правильно, он должен вызвать исключение `AttributeError`.

Чтобы запустить тест, откройте терминал и введите следующую команду:

```bash
python3 test_stock.py
```

Ожидаемый вывод выглядит следующим образом:

```
Stock: Stock('GOOG', 100, 490.1)
Name: GOOG
Shares: 100
Price: 490.1
Cost: 49010.0

Selling 20 shares...
Shares after selling: 80
Cost after selling: 39208.0

Trying to set an invalid attribute:
Error correctly caught: No attribute prices
```

## Запуск модульных тестов

Если у вас есть модульные тесты из предыдущих упражнений, вы можете запустить их на новой реализации. В терминале введите следующую команду:

```bash
python3 teststock.py
```

Обратите внимание, что некоторые тесты могут не пройти. Это может быть связано с тем, что они ожидают определенное поведение или методы, которые мы еще не реализовали. Не волнуйтесь! Мы будем продолжать развивать этот фундамент в будущих упражнениях.

## Обзор нашего прогресса

Возьмем мгновение, чтобы обзорвать, что мы достигли до сих пор:

1. Мы создали переиспользуемый базовый класс `Structure`. Этот класс:

   - Автоматически обрабатывает назначение атрибутов, что экономит нас от написания большого количества повторяющегося кода.
   - Предоставляет хорошее строковое представление, что облегчает вывод и отладку наших объектов.
   - Ограничивает имена атрибутов, чтобы предотвратить ошибки, что делает наш код более надежным.

2. Мы переписали наш класс `Stock`. Он:
   - Наследуется от класса `Structure`, чтобы повторно использовать общую функциональность.
   - Определяет только поля и методы, специфичные для области, что делает класс более сосредоточенным и чистым.
   - Имеет ясный и простой дизайн, что облегчает его понимание и поддержку.

Этот подход имеет несколько преимуществ для нашего кода:

- Он более поддерживаемый, так как у нас меньше повторений. Если нам нужно изменить что - то в общей функциональности, нам нужно изменить только класс `Structure`.
- Он более надежный благодаря лучшему контролю ошибок, предоставляемому классом `Structure`.
- Он более читаемый, так как обязанности каждого класса ясны.

В будущих упражнениях мы будем продолжать развивать этот фундамент, чтобы создать более сложную систему управления портфелем акций.
