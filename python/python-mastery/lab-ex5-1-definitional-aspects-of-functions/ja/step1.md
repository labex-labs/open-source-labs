# コンテキストの理解

前の演習では、CSV ファイルを読み込み、データを様々なデータ構造に格納するコードに遭遇したことがあるかもしれません。このコードの目的は、CSV ファイルから生のテキストデータを取得し、辞書やクラスインスタンスなどのより有用な Python オブジェクトに変換することです。この変換は、Python プログラム内でデータをより構造化された意味のある方法で扱うことができるため、不可欠です。

CSV ファイルを読み込む典型的なパターンは、特定の構造に従うことが多いです。以下は、CSV ファイルを読み込み、各行を辞書に変換する関数の例です。

```python
import csv

def read_csv_as_dicts(filename, types):
    records = []
    with open(filename) as file:
        rows = csv.reader(file)
        headers = next(rows)
        for row in rows:
            record = { name: func(val)
                       for name, func, val in zip(headers, types, row) }
            records.append(record)
    return records
```

この関数がどのように動作するかを分解してみましょう。まず、Python で CSV ファイルを扱う機能を提供する `csv` モジュールをインポートします。この関数は 2 つのパラメータを受け取ります。`filename` は読み込む CSV ファイルの名前で、`types` は各列のデータを適切なデータ型に変換するために使用される関数のリストです。

関数の内部では、CSV ファイルの各行を表す辞書を格納するために、`records` という空のリストを初期化します。その後、`with` 文を使用してファイルを開きます。これにより、コードブロックの実行後にファイルが適切に閉じられることが保証されます。`csv.reader` 関数を使用して、CSV ファイルの各行を読み取るイテレータを作成します。最初の行はヘッダーと見なされるため、`next` 関数を使用して取得します。

次に、関数は CSV ファイルの残りの行を反復処理します。各行について、辞書内包表記を使用して辞書を作成します。辞書のキーは列ヘッダーで、値は `types` リストからの対応する型変換関数を行内の値に適用した結果です。最後に、辞書は `records` リストに追加され、関数は辞書のリストを返します。

では、CSV ファイルからのデータをクラスインスタンスに読み込む類似の関数を見てみましょう。

```python
def read_csv_as_instances(filename, cls):
    records = []
    with open(filename) as file:
        rows = csv.reader(file)
        headers = next(rows)
        for row in rows:
            record = cls.from_row(row)
            records.append(record)
    return records
```

この関数は前の関数と似ていますが、辞書を作成する代わりに、クラスのインスタンスを作成します。この関数は 2 つのパラメータを受け取ります。`filename` は読み込む CSV ファイルの名前で、`cls` はインスタンスが作成されるクラスです。

関数の内部では、前の関数と同様の構造に従います。クラスインスタンスを格納するために、`records` という空のリストを初期化します。その後、ファイルを開き、ヘッダーを読み取り、残りの行を反復処理します。各行について、クラス `cls` の `from_row` メソッドを呼び出して、行のデータを使用してクラスのインスタンスを作成します。インスタンスは `records` リストに追加され、関数はインスタンスのリストを返します。

この実験では、これらの関数をリファクタリングして、より柔軟で堅牢なものにします。また、Python の型ヒントシステムを探索します。これにより、関数のパラメータと戻り値の期待される型を指定することができます。これにより、特にコードを共同で作業する他の開発者にとって、コードの可読性が向上し、理解しやすくなります。

まず、`reader.py` ファイルを作成し、これらの初期関数を追加しましょう。次の手順に進む前に、これらの関数が適切に動作することをテストするようにしてください。
