# Понимание исключений в Python

На этом этапе мы узнаем о исключениях в Python. Исключения - это важная концепция в программировании. Они помогают нам справляться с непредвиденными ситуациями, которые могут возникнуть во время выполнения программы. Мы также разберемся, почему текущий код аварийно завершается при попытке обработать некорректные данные. Понимание этого поможет вам писать более надежные и устойчивые программы на Python.

## Что такое исключения?

В Python исключения - это события, которые происходят во время выполнения программы и нарушают нормальный поток выполнения инструкций. Представьте себе это как препятствие на шоссе. Когда все идет гладко, ваша программа следует заранее определенному маршруту, как автомобиль на чистой дороге. Но когда возникает ошибка, Python создает объект исключения. Этот объект похож на отчет, который содержит информацию о том, что пошло не так, например, тип ошибки и место ее возникновения в коде.

Если эти исключения не обрабатываются корректно, они приводят к аварийному завершению программы. Когда происходит аварийное завершение, Python выводит сообщение трассировки стека (traceback). Это сообщение похоже на карту, которая показывает вам точное место в коде, где произошла ошибка. Оно очень полезно для отладки.

## Изучение текущего кода

Сначала давайте посмотрим на структуру файла `reader.py`. Этот файл содержит функции, которые используются для чтения и преобразования данных в формате CSV. Чтобы открыть файл в редакторе, нам нужно перейти в соответствующую директорию. Мы будем использовать команду `cd` в терминале.

```bash
cd /home/labex/project
```

Теперь, когда мы находимся в правильной директории, давайте посмотрим на содержимое файла `reader.py`. Этот файл содержит несколько важных функций:

1. `convert_csv()`: Эта функция принимает строки данных и использует предоставленную функцию преобразования для их преобразования. Она похожа на машину, которая принимает сырье (строки данных) и преобразует его в другой вид в соответствии с определенным рецептом (функцией преобразования).
2. `csv_as_dicts()`: Эта функция читает данные в формате CSV и преобразует их в список словарей. Она также выполняет преобразование типов, то есть она гарантирует, что каждый элемент данных в словаре имеет правильный тип, например, строку, целое число или число с плавающей точкой.
3. `read_csv_as_dicts()`: Это обертка (wrapper function). Она похожа на менеджера, который вызывает функцию `csv_as_dicts()` для выполнения задачи.

## Демонстрация проблемы

Давайте посмотрим, что происходит, когда код пытается обработать некорректные данные. Мы откроем интерпретатор Python, который похож на игровую площадку, где мы можем интерактивно тестировать наш код на Python. Чтобы открыть интерпретатор Python, мы используем следующую команду в терминале:

```bash
python3
```

После того, как интерпретатор Python открыт, мы попытаемся прочитать файл `missing.csv`. Этот файл содержит некоторые отсутствующие или некорректные данные. Мы будем использовать функцию `read_csv_as_dicts()` из файла `reader.py` для чтения данных.

```python
from reader import read_csv_as_dicts
port = read_csv_as_dicts('missing.csv', types=[str, int, float])
```

При запуске этого кода вы должны увидеть сообщение об ошибке, похожее на следующее:

```
Traceback (most recent call last):
  ...
ValueError: invalid literal for int() with base 10: ''
```

Эта ошибка возникает, потому что код пытается преобразовать пустую строку в целое число. Пустая строка не представляет собой допустимое целое число, поэтому Python не может выполнить преобразование. Функция аварийно завершается при первой встреченной ошибке и прекращает обработку остальных корректных данных в файле.

Чтобы выйти из интерпретатора Python, введите следующую команду:

```python
exit()
```

## Понимание потока ошибок

Ошибка возникает в функции `convert_csv()`, конкретно в следующей строке:

```python
return list(map(lambda row: converter(headers, row), rows))
```

Функция `map()` применяет функцию `converter` к каждой строке в списке `rows`. Функция `converter` пытается применить типы (str, int, float) к каждой строке. Но когда она встречает строку с отсутствующими данными, преобразование завершается неудачно. Функция `map()` не имеет встроенного способа обработки исключений. Поэтому, когда возникает исключение, весь процесс аварийно завершается.

На следующем этапе вы модифицируете код для корректной обработки этих исключений. Это означает, что вместо аварийного завершения программа сможет справиться с ошибками и продолжить обработку остальных данных.
