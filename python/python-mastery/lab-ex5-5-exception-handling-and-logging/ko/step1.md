# Python 의 예외 이해

이 단계에서는 Python 의 예외 (exception) 에 대해 배우겠습니다. 예외는 프로그래밍에서 중요한 개념입니다. 예외는 프로그램 실행 중에 발생할 수 있는 예기치 않은 상황을 처리하는 데 도움이 됩니다. 또한 현재 코드가 잘못된 데이터를 처리하려고 할 때 충돌하는 이유도 파악할 것입니다. 이를 이해하면 더 강력하고 신뢰할 수 있는 Python 프로그램을 작성하는 데 도움이 됩니다.

## 예외란 무엇인가요?

Python 에서 예외는 프로그램 실행 중에 발생하여 정상적인 명령 흐름을 방해하는 이벤트입니다. 고속도로의 길목과 같다고 생각하면 됩니다. 모든 것이 순조롭게 진행되면 프로그램은 정해진 경로를 따릅니다. 마치 맑은 도로를 달리는 자동차와 같습니다. 그러나 오류가 발생하면 Python 은 예외 객체를 생성합니다. 이 객체는 오류 유형 및 코드에서 오류가 발생한 위치와 같은 정보가 포함된 보고서와 같습니다.

이러한 예외를 적절하게 처리하지 않으면 프로그램이 충돌합니다. 충돌이 발생하면 Python 은 트레이스백 메시지 (traceback message) 를 표시합니다. 이 메시지는 오류가 발생한 코드의 정확한 위치를 보여주는 지도와 같습니다. 디버깅에 매우 유용합니다.

## 현재 코드 검토

먼저 `reader.py` 파일 구조를 살펴보겠습니다. 이 파일에는 CSV 데이터를 읽고 변환하는 데 사용되는 함수가 포함되어 있습니다. 편집기에서 파일을 열려면 올바른 디렉토리로 이동해야 합니다. 터미널에서 `cd` 명령을 사용합니다.

```bash
cd /home/labex/project
```

이제 올바른 디렉토리에 있으므로 `reader.py`의 내용을 살펴보겠습니다. 이 파일에는 몇 가지 중요한 함수가 있습니다.

1. `convert_csv()`: 이 함수는 데이터 행을 가져와 제공된 변환기 함수를 사용하여 변환합니다. 이는 원자재 (데이터 행) 를 가져와 특정 레시피 (변환기 함수) 에 따라 다른 형태로 변환하는 기계와 같습니다.
2. `csv_as_dicts()`: 이 함수는 CSV 데이터를 읽어 딕셔너리 목록으로 변환합니다. 또한 유형 변환 (type conversion) 을 수행합니다. 즉, 딕셔너리의 각 데이터 조각이 문자열, 정수 또는 부동 소수점과 같은 올바른 유형인지 확인합니다.
3. `read_csv_as_dicts()`: 이것은 래퍼 함수 (wrapper function) 입니다. `csv_as_dicts()` 함수를 호출하여 작업을 완료하는 관리자와 같습니다.

## 문제 시연

코드가 잘못된 데이터를 처리하려고 할 때 어떤 일이 발생하는지 살펴보겠습니다. Python 인터프리터 (interpreter) 를 열어보겠습니다. 이는 Python 코드를 대화식으로 테스트할 수 있는 놀이터와 같습니다. Python 인터프리터를 열려면 터미널에서 다음 명령을 사용합니다.

```bash
python3
```

Python 인터프리터가 열리면 `missing.csv` 파일을 읽어보겠습니다. 이 파일에는 누락되거나 잘못된 데이터가 포함되어 있습니다. `reader.py` 파일의 `read_csv_as_dicts()` 함수를 사용하여 데이터를 읽습니다.

```python
from reader import read_csv_as_dicts
port = read_csv_as_dicts('missing.csv', types=[str, int, float])
```

이 코드를 실행하면 다음과 같은 오류 메시지가 표시됩니다.

```
Traceback (most recent call last):
  ...
ValueError: invalid literal for int() with base 10: ''
```

이 오류는 코드가 빈 문자열을 정수로 변환하려고 하기 때문에 발생합니다. 빈 문자열은 유효한 정수를 나타내지 않으므로 Python 은 변환할 수 없습니다. 함수는 처음 만나는 오류에서 충돌하며 파일의 나머지 유효한 데이터 처리를 중단합니다.

Python 인터프리터를 종료하려면 다음 명령을 입력합니다.

```python
exit()
```

## 오류 흐름 이해

오류는 `convert_csv()` 함수, 특히 다음 줄에서 발생합니다.

```python
return list(map(lambda row: converter(headers, row), rows))
```

`map()` 함수는 `converter` 함수를 `rows` 목록의 각 행에 적용합니다. `converter` 함수는 유형 (str, int, float) 을 각 행에 적용하려고 시도합니다. 그러나 누락된 데이터가 있는 행을 만나면 실패합니다. `map()` 함수에는 예외를 처리하는 내장된 방법이 없습니다. 따라서 예외가 발생하면 전체 프로세스가 충돌합니다.

다음 단계에서는 이러한 예외를 적절하게 처리하도록 코드를 수정합니다. 즉, 충돌하는 대신 프로그램이 오류를 처리하고 나머지 데이터를 계속 처리할 수 있습니다.
