# 딕셔너리 메모리 할당

Python 에서 리스트와 마찬가지로 딕셔너리는 기본적인 데이터 구조입니다. 딕셔너리에 대해 이해해야 할 중요한 측면 중 하나는 메모리를 할당하는 방식입니다. 메모리 할당은 Python 이 딕셔너리의 데이터를 저장하기 위해 컴퓨터의 메모리에 공간을 확보하는 방식을 의미합니다. 리스트와 유사하게 Python 딕셔너리도 청크 단위로 메모리를 할당합니다. 딕셔너리로 메모리 할당이 어떻게 작동하는지 살펴보겠습니다.

1. 먼저, 작업할 딕셔너리를 만들어야 합니다. 동일한 Python 셸에서 (또는 닫았다면 새 셸을 엽니다) 데이터 레코드를 나타내는 딕셔너리를 만들 것입니다. Python 의 딕셔너리는 키 - 값 쌍의 모음이며, 각 키는 고유하며 해당 값을 액세스하는 데 사용됩니다.

```python
import sys  # Import sys if you're starting a new session
row = {'route': '22', 'date': '01/01/2001', 'daytype': 'U', 'rides': 7354}
```

여기서는 Python 인터프리터에서 사용하거나 유지 관리하는 일부 변수와 인터프리터와 강력하게 상호 작용하는 함수에 대한 액세스를 제공하는 `sys` 모듈을 가져왔습니다. 그런 다음 네 개의 키 - 값 쌍이 있는 `row`라는 딕셔너리를 만들었습니다.

2. 이제 딕셔너리가 있으므로 초기 크기를 확인하려고 합니다. 딕셔너리의 크기는 컴퓨터에서 차지하는 메모리 양을 나타냅니다.

```python
sys.getsizeof(row)
```

`sys.getsizeof()` 함수는 객체의 크기를 바이트 단위로 반환합니다. 이 코드를 실행하면 약 `240` 바이트의 값을 볼 수 있습니다. 이를 통해 딕셔너리가 처음에 얼마나 많은 메모리를 차지하는지 알 수 있습니다.

3. 다음으로, 딕셔너리에 새로운 키 - 값 쌍을 추가하고 메모리 할당이 어떻게 변경되는지 관찰합니다. 딕셔너리에 항목을 추가하는 것은 일반적인 작업이며, 메모리에 미치는 영향을 이해하는 것이 중요합니다.

```python
row['a'] = 1
sys.getsizeof(row)  # Size might remain the same

row['b'] = 2
sys.getsizeof(row)  # Size may increase
```

첫 번째 키 - 값 쌍 (`'a': 1`) 을 추가하면 딕셔너리의 크기가 동일하게 유지될 수 있습니다. 이는 Python 이 이미 특정 메모리 청크를 할당했고, 새 항목을 수용할 공간이 해당 청크에 충분할 수 있기 때문입니다. 그러나 두 번째 키 - 값 쌍 (`'b': 2`) 을 추가하면 크기가 증가할 수 있습니다. 일정 수의 항목을 추가한 후 딕셔너리의 크기가 갑자기 증가하는 것을 알 수 있습니다. 이는 딕셔너리가 리스트와 마찬가지로 성능을 최적화하기 위해 청크 단위로 메모리를 할당하기 때문입니다. 청크 단위로 메모리를 할당하면 Python 이 시스템에서 더 많은 메모리를 요청해야 하는 횟수가 줄어들어 새 항목을 추가하는 프로세스가 빨라집니다.

4. 딕셔너리에서 항목을 제거하여 메모리 사용량이 감소하는지 확인해 보겠습니다. 딕셔너리에서 항목을 제거하는 것도 일반적인 작업이며, 메모리에 미치는 영향을 확인하는 것이 흥미롭습니다.

```python
del row['b']
sys.getsizeof(row)
```

흥미롭게도 항목을 제거해도 일반적으로 메모리 할당이 줄어들지 않습니다. 이는 Python 이 항목을 다시 추가하는 경우 재할당을 피하기 위해 할당된 메모리를 유지하기 때문입니다. 메모리 재할당은 성능 측면에서 비교적 비용이 많이 드는 작업이므로 Python 은 가능한 한 이를 피하려고 합니다.

**메모리 효율성 고려 사항:**

많은 레코드를 만들어야 하는 대규모 데이터 세트로 작업할 때, 각 레코드에 딕셔너리를 사용하는 것이 가장 메모리 효율적인 방법이 아닐 수 있습니다. 딕셔너리는 매우 유연하고 사용하기 쉽지만, 특히 많은 수의 레코드를 처리할 때 상당한 양의 메모리를 소비할 수 있습니다. 다음은 더 적은 메모리를 소비하는 몇 가지 대안입니다.

- 튜플 (Tuple): 간단한 불변 시퀀스. 튜플은 생성된 후 변경할 수 없는 값의 모음입니다. 키를 저장하고 관련 키 - 값 매핑을 관리할 필요가 없기 때문에 딕셔너리보다 적은 메모리를 사용합니다.
- 명명된 튜플 (Named tuple): 필드 이름이 있는 튜플. 명명된 튜플은 일반 튜플과 유사하지만, 이름을 사용하여 값에 액세스할 수 있으므로 코드를 더 읽기 쉽게 만들 수 있습니다. 또한 딕셔너리보다 적은 메모리를 사용합니다.
- `__slots__`가 있는 클래스: 인스턴스 변수에 딕셔너리를 사용하지 않도록 명시적으로 속성을 정의하는 클래스. 클래스에서 `__slots__`를 사용하면 Python 은 인스턴스 변수를 저장하기 위해 딕셔너리를 생성하지 않으므로 메모리 사용량이 줄어듭니다.

이러한 대안은 많은 레코드를 처리할 때 메모리 사용량을 크게 줄일 수 있습니다.
