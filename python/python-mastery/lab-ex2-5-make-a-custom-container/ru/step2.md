# Распределение памяти для словарей

В Python, как и списки, словари являются фундаментальной структурой данных. Одним из важных аспектов, которые нужно понять о них, является то, как они распределяют память. Распределение памяти означает, как Python отводит место в памяти компьютера для хранения данных в вашем словаре. Как и списки, словари Python также выделяют память блоками. Исследуем, как работает распределение памяти для словарей.

1. Сначала нам нужно создать словарь, с которым будем работать. В той же оболочке Python (или откройте новую, если вы ее закрыли), мы создадим словарь, представляющий запись данных. Словарь в Python представляет собой коллекцию пар ключ - значение, где каждый ключ уникален и используется для доступа к соответствующему значению.

```python
import sys  # Импортируйте sys, если вы начали новую сессию
row = {'route': '22', 'date': '01/01/2001', 'daytype': 'U', 'rides': 7354}
```

Здесь мы импортировали модуль `sys`, который предоставляет доступ к некоторым переменным, используемым или поддерживаемым интерпретатором Python, а также к функциям, которые сильно взаимодействуют с интерпретатором. Затем мы создали словарь с именем `row` с четырьмя парами ключ - значение.

2. Теперь, когда у нас есть наш словарь, мы хотим проверить его начальный размер. Размер словаря означает количество памяти, которое он занимает в компьютере.

```python
sys.getsizeof(row)
```

Функция `sys.getsizeof()` возвращает размер объекта в байтах. Когда вы запустите этот код, вы должны увидеть значение около `240` байт. Это дает вам представление о том, сколько памяти занимает словарь изначально.

3. Далее мы добавим новые пары ключ - значение в словарь и посмотрим, как изменится распределение памяти. Добавление элементов в словарь - это обычная операция, и понимание того, как это влияет на память, очень важно.

```python
row['a'] = 1
sys.getsizeof(row)  # Размер может остаться прежним

row['b'] = 2
sys.getsizeof(row)  # Размер может увеличиться
```

Когда вы добавляете первую пару ключ - значение (`'a': 1`), размер словаря может остаться прежним. Это происходит потому, что Python уже выделил определенный блок памяти, и в этом блоке может быть достаточно места для нового элемента. Однако, когда вы добавляете вторую пару ключ - значение (`'b': 2`), размер может увеличиться. Вы заметите, что после добавления определенного количества элементов размер словаря внезапно увеличивается. Это происходит потому, что словари, как и списки, выделяют память блоками для оптимизации производительности. Выделение памяти блоками уменьшает количество раз, когда Python должен запрашивать больше памяти у системы, что ускоряет процесс добавления новых элементов.

4. Попробуем удалить элемент из словаря, чтобы увидеть, уменьшится ли использование памяти. Удаление элементов из словаря также является обычной операцией, и интересно посмотреть, как это влияет на память.

```python
del row['b']
sys.getsizeof(row)
```

Интересно, что удаление элемента обычно не уменьшает распределение памяти. Это происходит потому, что Python сохраняет выделенную память, чтобы избежать перераспределения, если элементы будут добавлены снова. Перераспределение памяти - это относительно затратная операция с точки зрения производительности, поэтому Python пытается избегать ее как можно чаще.

**Вопросы эффективности использования памяти:**

При работе с большими наборами данных, когда вам нужно создать много записей, использование словарей для каждой записи может не быть самым эффективным с точки зрения памяти подходом. Словари очень гибкие и просты в использовании, но они могут потреблять значительное количество памяти, особенно при работе с большим количеством записей. Вот некоторые альтернативы, которые потребляют меньше памяти:

- Кортежи (tuples): Простые неизменяемые последовательности. Кортеж - это коллекция значений, которые не могут быть изменены после создания. Он использует меньше памяти, чем словарь, потому что не нужно хранить ключи и управлять связанным отображением ключ - значение.
- Именнованные кортежи (named tuples): Кортежи с именами полей. Именнованные кортежи похожи на обычные кортежи, но они позволяют вам получать доступ к значениям по имени, что может сделать код более читаемым. Они также используют меньше памяти, чем словари.
- Классы с `__slots__`: Классы, которые явно определяют атрибуты, чтобы избежать использования словаря для переменных экземпляра. Когда вы используете `__slots__` в классе, Python не создает словарь для хранения переменных экземпляра, что уменьшает использование памяти.

Эти альтернативы могут значительно уменьшить использование памяти при обработке большого количества записей.
