# Понимание основного модуля в Python

В Python, когда вы запускаете скрипт напрямую, он выступает в роли "основного" модуля. Python имеет специальную переменную с именем `__name__`. Когда файл выполняется напрямую, Python устанавливает значение переменной `__name__` равным `"__main__"`. Это отличается от ситуации, когда файл импортируется как модуль.

Эта особенность очень полезна, так как позволяет писать код, который ведет себя по - разному в зависимости от того, запущен ли файл напрямую или импортирован. Например, вы можете захотеть, чтобы некоторый код выполнялся только при запуске файла как скрипта, но не при его импорте другим скриптом.

## Изменение файла pcost.py для использования шаблона основного модуля

Давайте изменим программу `pcost.py`, чтобы воспользоваться этим шаблоном.

1. Сначала вам нужно открыть файл `pcost.py` в редакторе. Вы можете использовать следующие команды, чтобы перейти в директорию проекта и создать файл, если он не существует:

```bash
cd ~/project
touch pcost.py
```

Команда `cd` изменяет текущую директорию на директорию `project` в вашей домашней директории. Команда `touch` создает новый файл с именем `pcost.py`, если он еще не существует.

2. Теперь измените файл `pcost.py` так, чтобы он выглядел следующим образом:

```python
# pcost.py

def portfolio_cost(filename):
    total_cost = 0.0

    with open(filename, 'r') as f:
        for line in f:
            fields = line.split()
            try:
                nshares = int(fields[1])
                price = float(fields[2])
                total_cost += nshares * price
            except (ValueError, IndexError):
                print(f"Couldn't parse: {line}")

    return total_cost

# This code only runs when the file is executed as a script
if __name__ == "__main__":
    total = portfolio_cost('portfolio.dat')
    print(total)
```

Основное изменение здесь заключается в том, что мы обернули код в конце в условие `if __name__ == "__main__":`. Это означает, что код внутри этого блока будет выполняться только при прямом запуске файла как скрипта, а не при его импорте как модуля.

3. После внесения этих изменений сохраните файл и выйдите из редактора.

## Тестирование измененного модуля

Теперь давайте протестируем наш измененный модуль двумя разными способами, чтобы увидеть, как он ведет себя.

1. Сначала запустите программу напрямую как скрипт, используя следующую команду:

```bash
python3 pcost.py
```

Вы должны увидеть вывод `44671.15`, как и раньше. Это происходит потому, что при прямом запуске скрипта переменная `__name__` устанавливается равной `"__main__"`, поэтому код внутри блока `if __name__ == "__main__":` выполняется.

2. Затем запустите интерпретатор Python снова и импортируйте модуль:

```bash
python3
```

```python
import pcost
```

На этот раз вы не увидите никакого вывода. Когда вы импортируете модуль, переменная `__name__` устанавливается равной `"pcost"` (имени модуля), а не `"__main__"`. Поэтому код внутри блока `if __name__ == "__main__":` не выполняется.

3. Чтобы убедиться, что функция `portfolio_cost` по - прежнему работает, вы можете вызвать ее следующим образом:

```python
pcost.portfolio_cost('portfolio.dat')
```

Функция должна вернуть `44671.15`, что означает, что она работает корректно.

4. Наконец, выйдите из интерпретатора Python, используя следующую команду:

```python
exit()
```

Этот шаблон очень полезен при создании файлов на Python, которые могут быть использованы как импортируемые модули, так и как самостоятельные скрипты. Код внутри блока `if __name__ == "__main__":` выполняется только при прямом запуске файла, а не при его импорте как модуля.
