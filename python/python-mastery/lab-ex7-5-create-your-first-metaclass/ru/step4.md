# Исследование наследования метаклассов

Метаклассы обладают интересным свойством: они "липкие". Это означает, что если класс использует метакласс, то все его подклассы в иерархии наследования также будут использовать тот же метакласс. Другими словами, свойство метакласса распространяется по цепочке наследования.

Давайте посмотрим, как это работает на практике:

1. Сначала откройте файл `mymeta.py`. В конце этого файла мы добавим новый класс. Этот класс с именем `MyStock` будет наследоваться от класса `Stock`. Метод `__init__` используется для инициализации атрибутов объекта, и мы вызываем метод `__init__` родительского класса с помощью `super().__init__` для инициализации общих атрибутов. Метод `info` используется для возврата отформатированной строки с информацией о акциях. Добавьте следующий код:

```python
class MyStock(Stock):
    def __init__(self, name, shares, price, category):
        super().__init__(name, shares, price)
        self.category = category

    def info(self):
        return f"{self.name} ({self.category}): {self.shares} shares at ${self.price}"
```

2. После добавления кода сохраните файл `mymeta.py`. Сохранение файла гарантирует, что внесенные изменения будут сохранены и могут быть использованы позже.

3. Теперь мы создадим новый файл с именем `test_inheritance.py` для тестирования поведения наследования метакласса. В этом файле мы импортируем класс `MyStock` из файла `mymeta.py`. Затем мы создадим экземпляр класса `MyStock`, вызовем его методы и выведем результаты, чтобы увидеть, как метакласс работает через наследование. Добавьте следующий код в `test_inheritance.py`:

```python
# test_inheritance.py
from mymeta import MyStock

# Create a MyStock instance
tech_stock = MyStock("MSFT", 50, 305.75, "Technology")

# Test the methods
print(tech_stock.info())
print(f"Total cost: ${tech_stock.cost()}")

# Sell some shares
tech_stock.sell(5)
print(f"After selling: {tech_stock.shares} shares remaining")
print(f"Updated cost: ${tech_stock.cost()}")
```

4. Наконец, запустите файл `test_inheritance.py`, чтобы увидеть, как метакласс работает через наследование. Откройте терминал, перейдите в директорию, где находится файл `test_inheritance.py`, и выполните следующую команду:

```bash
python3 test_inheritance.py
```

Вы должны увидеть вывод, похожий на следующий:

```
Creating class : myobject
Base classes   : ()
Attributes     : ['__module__', '__qualname__', '__doc__']
Creating class : Stock
Base classes   : (<class 'mymeta.myobject'>,)
Attributes     : ['__module__', '__qualname__', '__init__', 'cost', 'sell', '__doc__']
Creating class : MyStock
Base classes   : (<class 'mymeta.Stock'>,)
Attributes     : ['__module__', '__qualname__', '__init__', 'info', '__doc__']
MSFT (Technology): 50 shares at $305.75
Total cost: $15287.5
After selling: 45 shares remaining
Updated cost: $13758.75
```

Обратите внимание, что даже несмотря на то, что мы явно не указали метакласс для класса `MyStock`, метакласс все равно применяется. Это ясно демонстрирует, как метаклассы распространяются через наследование.

## Практические применения метаклассов

В нашем примере метакласс просто выводит информацию о классах. Однако метаклассы имеют множество практических применений в реальном программировании:

1. **Валидация**: Вы можете использовать метаклассы для проверки наличия у класса необходимых методов или атрибутов. Это помогает гарантировать, что классы соответствуют определенным критериям перед использованием.
2. **Регистрация**: Метаклассы могут автоматически регистрировать классы в реестре. Это полезно, когда вам нужно отслеживать все классы определенного типа.
3. **Применение интерфейсов**: Они могут быть использованы для обеспечения реализации классами обязательных интерфейсов. Это помогает поддерживать последовательную структуру в вашем коде.
4. **Аспектно - ориентированное программирование**: Метаклассы могут добавлять поведения к методам. Например, вы можете добавить логирование или мониторинг производительности методов без прямого изменения кода метода.
5. **Системы ORM**: В системах объектно - реляционного отображения (ORM), таких как Django или SQLAlchemy, метаклассы используются для отображения классов на таблицы базы данных. Это упрощает операции с базой данных в вашем приложении.

Метаклассы очень мощные, но их следует использовать с осторожностью. Как однажды сказал Тим Петерс (известный автор "Дзен Python"): "Метаклассы - это магия, о которой должен беспокоиться не более 1% пользователей".
