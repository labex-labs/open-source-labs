# 関数の定義

このステップでは、関数を作成する方法を学びます。Python の関数は、単一の関連するアクションを実行するために使用される、組織化された再利用可能なコードブロックです。ここでは、関数がファイルからポートフォリオデータを読み取り、総コストを計算するようにします。この関数を作成すると、異なるポートフォリオファイルで何度も使用できるため、同じコードを何度も書く手間が省けます。

## 問題の理解

前の実験では、ポートフォリオデータを読み取り、総コストを計算するコードを書いたかもしれません。しかし、そのコードは再利用が容易ではない書き方になっている可能性があります。今回は、そのコードを再利用可能な関数に変換します。

ポートフォリオデータファイルには特定の形式があります。これらのファイルには「シンボル 株数 価格」の形式で情報が含まれています。ファイル内の各行は株式の保有状況を表しています。たとえば、`portfolio.dat` という名前のファイルには、次のような行が含まれているかもしれません。

```
AA 100 32.20
IBM 50 91.10
...
```

ここで、最初の部分（「AA」や「IBM」など）は株式シンボルで、株式の一意の識別子です。2 番目の部分はその株式の保有株数で、3 番目の部分は 1 株あたりの価格です。

## 関数の作成

`/home/labex/project` ディレクトリに `pcost.py` という名前の Python ファイルを作成しましょう。このファイルには、私たちの関数が含まれます。以下は、`pcost.py` ファイルに記述するコードです。

```python
def portfolio_cost(filename):
    """
    Computes the total cost (shares*price) of a portfolio file

    Args:
        filename: The name of the portfolio file

    Returns:
        The total cost of the portfolio as a float
    """
    total_cost = 0.0

    # Open the file and read through each line
    with open(filename, 'r') as f:
        for line in f:
            fields = line.split()
            # Extract the data (symbol, shares, price)
            shares = int(fields[1])
            price = float(fields[2])
            # Add the cost to our running total
            total_cost += shares * price

    return total_cost

# Call the function with the portfolio.dat file
if __name__ == '__main__':
    cost = portfolio_cost('/home/labex/project/portfolio.dat')
    print(cost)
```

このコードでは、まず `filename` を引数とする `portfolio_cost` という名前の関数を定義しています。関数内では、`total_cost` 変数を 0.0 に初期化します。次に、`open` 関数を使用してファイルを読み取りモード（`'r'`）で開きます。`for` ループを使用して、ファイルの各行を処理します。各行について、`split()` メソッドを使用してフィールドに分割します。その後、株数を整数に変換し、価格を浮動小数点数に変換します。株数と価格を掛け合わせてその株式のコストを計算し、`total_cost` に加算します。最後に、`total_cost` を返します。

`if __name__ == '__main__':` の部分は、スクリプトが直接実行されたときに関数を呼び出すために使用されます。`portfolio.dat` ファイルのパスを関数に渡し、結果を出力します。

## 関数のテスト

では、プログラムが機能するかどうかを確認するために実行しましょう。`pcost.py` ファイルがあるディレクトリに移動し、Python スクリプトを実行する必要があります。以下は、そのためのコマンドです。

```bash
cd /home/labex/project
python3 pcost.py
```

これらのコマンドを実行すると、次のような出力が表示されるはずです。

```
44671.15
```

この出力は、ポートフォリオ内のすべての株式の総コストを表しています。

## コードの理解

関数が行う処理をステップごとに分解してみましょう。

1. `filename` を入力パラメータとして受け取ります。これにより、異なるポートフォリオファイルで関数を使用することができます。
2. ファイルを開き、1 行ずつ読み取ります。これは `open` 関数と `for` ループを使用して行われます。
3. 各行について、`split()` メソッドを使用してフィールドに分割します。このメソッドは、空白を基準に行を文字列のリストに分割します。
4. 株数を整数に、価格を浮動小数点数に変換します。ファイルから読み取ったデータは文字列形式なので、算術演算を行うために変換する必要があります。
5. 各株式のコスト（株数 \* 価格）を計算し、累計に加算します。これにより、ポートフォリオの総コストが得られます。
6. 最終的な総コストを返します。必要に応じて、この結果をプログラムの他の部分で使用することができます。

この関数は現在、再利用可能です。異なるポートフォリオファイルを指定して関数を呼び出すことで、それらのコストを計算できます。これにより、コードがより効率的で保守しやすくなります。
