# 定义函数

在这一步中，你将学习如何创建一个函数。Python 中的函数是一段组织有序、可重复使用的代码块，用于执行单个相关的操作。在这里，我们的函数将从文件中读取投资组合数据并计算总成本。这很有用，因为一旦我们有了这个函数，就可以多次使用它来处理不同的投资组合文件，避免反复编写相同的代码。

## 理解问题

在之前的实验中，你可能已经编写了一些代码来读取投资组合数据并计算总成本。但这些代码可能编写方式不利于复用。现在，我们要将这些代码转换为一个可重复使用的函数。

投资组合数据文件有特定的格式。它们以“股票代码 股数 价格”的形式包含信息。文件中的每一行代表一项股票持仓。例如，在名为 `portfolio.dat` 的文件中，你可能会看到如下行：

```
AA 100 32.20
IBM 50 91.10
...
```

这里，第一部分（如“AA”或“IBM”）是股票代码，它是股票的唯一标识符。第二部分是你持有的该股票的股数，第三部分是每股价格。

## 创建函数

让我们在 `/home/labex/project` 目录下创建一个名为 `pcost.py` 的 Python 文件。这个文件将包含我们的函数。以下是我们要放在 `pcost.py` 文件中的代码：

```python
def portfolio_cost(filename):
    """
    计算投资组合文件的总成本（股数 * 价格）

    参数：
        filename: 投资组合文件的名称

    返回：
        投资组合的总成本，以浮点数表示
    """
    total_cost = 0.0

    # 打开文件并逐行读取
    with open(filename, 'r') as f:
        for line in f:
            fields = line.split()
            # 提取数据（股票代码、股数、价格）
            shares = int(fields[1])
            price = float(fields[2])
            # 将成本累加到总成本中
            total_cost += shares * price

    return total_cost

# 使用 portfolio.dat 文件调用函数
if __name__ == '__main__':
    cost = portfolio_cost('/home/labex/project/portfolio.dat')
    print(cost)
```

在这段代码中，我们首先定义了一个名为 `portfolio_cost` 的函数，它接受一个 `filename` 作为参数。在函数内部，我们将变量 `total_cost` 初始化为 0.0。然后，我们使用 `open` 函数以只读模式（`'r'`）打开文件。我们使用 `for` 循环遍历文件中的每一行。对于每一行，我们使用 `split()` 方法将其拆分为多个字段。然后，我们提取股数并将其转换为整数，提取价格并将其转换为浮点数。我们通过将股数乘以价格来计算该股票持仓的成本，并将其添加到 `total_cost` 中。最后，我们返回 `total_cost`。

`if __name__ == '__main__':` 部分用于在脚本直接运行时调用函数。我们将 `portfolio.dat` 文件的路径传递给函数，并打印结果。

## 测试函数

现在，让我们运行程序，看看它是否能正常工作。我们需要导航到 `pcost.py` 文件所在的目录，然后运行 Python 脚本。以下是执行这些操作的命令：

```bash
cd /home/labex/project
python3 pcost.py
```

运行这些命令后，你应该会看到如下输出：

```
44671.15
```

这个输出表示投资组合中所有股票的总成本。

## 理解代码

让我们逐步分析我们的函数所执行的操作：

1. 它接受一个 `filename` 作为输入参数。这使我们能够使用该函数处理不同的投资组合文件。
2. 它打开文件并逐行读取。这通过 `open` 函数和 `for` 循环实现。
3. 对于每一行，它使用 `split()` 方法将其拆分为多个字段。该方法根据空白字符将行拆分为字符串列表。
4. 它将股数转换为整数，将价格转换为浮点数。这是必要的，因为从文件中读取的数据是字符串格式，而我们需要对它们进行算术运算。
5. 它计算每一项股票持仓的成本（股数 \* 价格），并将其累加到总成本中。这使我们得到投资组合的总成本。
6. 它返回最终的总成本。这使我们可以在程序的其他部分使用该结果（如果需要）。

现在，这个函数是可重复使用的。我们可以使用不同的投资组合文件调用它来计算它们的成本，这使我们的代码更高效且更易于维护。
