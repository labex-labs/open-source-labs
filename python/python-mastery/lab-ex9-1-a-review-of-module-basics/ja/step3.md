# モジュールの読み込み動作の理解

Python では、モジュールの読み込み方法にいくつか興味深い特性があります。このステップでは、これらの動作を調べて、Python がモジュールの読み込みをどのように管理しているかを理解しましょう。

1. まず、同じ Python インタープリタセッション内でモジュールを再度インポートしようとしたときに何が起こるかを見てみましょう。Python インタープリタを起動すると、Python コードを実行できる作業スペースが開かれるようなものです。一度モジュールをインポートした後、再度インポートするとモジュールが再読み込みされるように思えるかもしれませんが、実際はそうではありません。

```python
>>> import simplemod
```

今回は「Loaded simplemod」という出力が表示されないことに注意してください。これは、**Python はインタープリタセッションごとにモジュールを一度だけ読み込む**からです。その後の `import` 文はモジュールを再読み込みしません。Python はすでにモジュールを読み込んだことを記憶しているので、再度読み込むプロセスを経ません。

2. モジュールをインポートした後、その中の変数を変更することができます。Python のモジュールは、変数、関数、クラスを保持するコンテナのようなものです。モジュールをインポートしたら、他の Python オブジェクトと同じように、その変数にアクセスして変更することができます。

```python
>>> simplemod.x
42
>>> simplemod.x = 13
>>> simplemod.x
13
>>> simplemod.foo()
x is 13
```

ここでは、まず `simplemod` モジュール内の変数 `x` の値を確認します。最初は `42` です。次にその値を `13` に変更し、変更が反映されていることを確認します。モジュール内の `foo` 関数を呼び出すと、`x` の新しい値が反映されます。

3. モジュールを再度インポートしても、その変数に加えた変更はリセットされません。もう一度モジュールをインポートしようとしても、Python はそれを再読み込みしないので、変数に加えた変更は保持されます。

```python
>>> import simplemod
>>> simplemod.x
13
```

4. モジュールを強制的に再読み込みしたい場合は、`importlib.reload()` 関数を使用する必要があります。時には、モジュールのコードに変更を加え、それらの変更を即座に反映させたいことがあります。`importlib.reload()` 関数を使用すると、それが可能になります。

```python
>>> import importlib
>>> importlib.reload(simplemod)
Loaded simplemod
<module 'simplemod' from 'simplemod.py'>
>>> simplemod.x
42
>>> simplemod.foo()
x is 42
```

モジュールが再読み込みされ、`x` の値が `42` にリセットされました。これは、モジュールがソースコードから再度読み込まれ、すべての変数が元の状態に初期化されたことを示しています。

5. Python は、すべての読み込まれたモジュールを `sys.modules` 辞書に記録します。この辞書は、現在のインタープリタセッション中に読み込まれたすべてのモジュールに関する情報を格納するレジストリのようなものです。

```python
>>> 'simplemod' in sys.modules
True
>>> sys.modules['simplemod']
<module 'simplemod' from 'simplemod.py'>
```

モジュール名が `sys.modules` 辞書に含まれているかどうかを確認することで、そのモジュールが読み込まれているかどうかを確認できます。また、モジュール名をキーとして辞書にアクセスすることで、そのモジュールに関する情報を取得できます。

6. この辞書からモジュールを削除すると、次回のインポート時に Python がそれを再読み込みするように強制できます。`sys.modules` 辞書からモジュールを削除すると、Python はそのモジュールをすでに読み込んだことを忘れます。したがって、次にそのモジュールをインポートしようとすると、Python はソースコードから再度読み込みます。

```python
>>> del sys.modules['simplemod']
>>> import simplemod
Loaded simplemod
>>> simplemod.x
42
```

モジュールは `sys.modules` から削除されたため、再度読み込まれました。これは、モジュールのコードの最新バージョンを使用することを保証する別の方法です。
