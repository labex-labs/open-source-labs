# Исследование ограничений перезагрузки модулей

Перезагрузка модулей - полезная функция в Python, но она имеет некоторые ограничения, особенно при работе с классами. В этом разделе мы пошагово рассмотрим эти ограничения. Понимание этих ограничений является важным как для среды разработки, так и для продакшена.

1. Перезапустите интерпретатор Python:
   Сначала нам нужно перезапустить интерпретатор Python. Этот шаг важен, так как он гарантирует, что мы начинаем с "чистого листа". При перезапуске интерпретатора все ранее импортированные модули и переменные очищаются. Чтобы выйти из текущего интерпретатора Python, используйте команду `exit()`. Затем запустите новую сессию интерпретатора Python с помощью команды `python3` в терминале.

```python
>>> exit()
```

```bash
python3
```

2. Импортируйте модуль и создайте экземпляр класса `Spam`:
   Теперь, когда у нас есть новая сессия интерпретатора Python, мы импортируем модуль `simplemod`. Импорт модуля позволяет нам использовать классы, функции и переменные, определенные в этом модуле. После импорта модуля мы создадим экземпляр класса `Spam` и вызовем его метод `yow()`. Это поможет нам увидеть первоначальное поведение класса.

```python
>>> import simplemod
Loaded simplemod
>>> s = simplemod.Spam()
>>> s.yow()
Yow!
```

3. Теперь изменим класс `Spam` в нашем модуле. Выйдите из интерпретатора Python:
   Далее мы собираемся внести изменения в класс `Spam` в модуле `simplemod`. Перед этим нам нужно выйти из интерпретатора Python. Это связано с тем, что мы хотим внести изменения в исходный код модуля и затем увидеть, как эти изменения влияют на поведение класса.

```python
>>> exit()
```

4. Откройте файл `simplemod.py` в WebIDE и измените класс `Spam`:
   Откройте файл `simplemod.py` в WebIDE. Именно здесь находится исходный код модуля `simplemod`. Мы изменим метод `yow()` класса `Spam` так, чтобы он выводил другое сообщение. Это изменение поможет нам наблюдать, как поведение класса меняется после перезагрузки модуля.

```python
# simplemod.py
# ... (оставьте остальную часть файла без изменений)

class Spam:
    def yow(self):
        print('More Yow!')  # Changed from 'Yow!'
```

5. Сохраните файл и вернитесь в терминал. Запустите интерпретатор Python и создайте новый экземпляр:
   После внесения изменений в файл `simplemod.py` сохраните его. Затем вернитесь в терминал и запустите новую сессию интерпретатора Python. Импортируйте модуль `simplemod` снова и создайте новый экземпляр класса `Spam`. Вызовите метод `yow()` нового экземпляра, чтобы увидеть обновленное поведение.

```bash
python3
```

```python
>>> import simplemod
Loaded simplemod
>>> t = simplemod.Spam()
>>> t.yow()
More Yow!
```

6. Теперь продемонстрируем, что происходит при перезагрузке:
   Чтобы увидеть, как работает перезагрузка модуля, мы используем функцию `importlib.reload()`. Эта функция позволяет нам перезагрузить ранее импортированный модуль. После перезагрузки модуля мы проверим, отражаются ли изменения, которые мы внесли в класс `Spam`.

```python
>>> import importlib
>>> importlib.reload(simplemod)
Loaded simplemod
<module 'simplemod' from 'simplemod.py'>
```

7. Выйдите из Python, измените файл еще раз и протестируйте оба экземпляра:
   Выйдите из интерпретатора Python еще раз. Затем внесите еще одно изменение в класс `Spam` в файле `simplemod.py`. После этого мы протестируем как старый, так и новый экземпляры класса `Spam`, чтобы увидеть, как они ведут себя.

```python
>>> exit()
```

8. Обновите файл `simplemod.py`:
   Откройте файл `simplemod.py` снова и измените метод `yow()` класса `Spam` так, чтобы он выводил другое сообщение. Это изменение поможет нам лучше понять ограничения перезагрузки модулей.

```python
# simplemod.py
# ... (оставьте остальную часть файла без изменений)

class Spam:
    def yow(self):
        print('Even More Yow!')  # Changed again
```

9. Сохраните файл и вернитесь в терминал:
   Сохраните изменения в файле `simplemod.py` и вернитесь в терминал. Запустите новую сессию интерпретатора Python, импортируйте модуль `simplemod` и создайте новый экземпляр класса `Spam`. Вызовите метод `yow()` нового экземпляра, чтобы увидеть обновленное поведение.

```bash
python3
```

```python
>>> import simplemod
Loaded simplemod
>>> s = simplemod.Spam()
>>> s.yow()
Even More Yow!

>>> # Exit without closing Python, edit the file
```

10. Не закрывая Python, откройте `simplemod.py` в WebIDE и измените его:
    Не закрывая интерпретатор Python, откройте файл `simplemod.py` в WebIDE и внесите еще одно изменение в метод `yow()` класса `Spam`. Это поможет нам увидеть, как поведение существующих и новых экземпляров меняется после перезагрузки модуля.

```python
# simplemod.py
# ... (оставьте остальную часть файла без изменений)

class Spam:
    def yow(self):
        print('Super Yow!')  # Changed one more time
```

11. Сохраните файл и вернитесь в интерпретатор Python:
    Сохраните изменения в файле `simplemod.py` и вернитесь в интерпретатор Python. Перезагрузите модуль `simplemod` с помощью функции `importlib.reload()`. Затем протестируйте как старый, так и новый экземпляры класса `Spam`, чтобы увидеть, как они ведут себя.

```python
>>> import importlib
>>> importlib.reload(simplemod)
Loaded simplemod
<module 'simplemod' from 'simplemod.py'>

>>> # Try the old instance
>>> s.yow()
Even More Yow!  # Still uses the old implementation

>>> # Create a new instance
>>> t = simplemod.Spam()
>>> t.yow()
Super Yow!  # Uses the new implementation
```

Обратите внимание, что старый экземпляр `s` по-прежнему использует старую реализацию, в то время как новый экземпляр `t` использует новую. Это происходит потому, что перезагрузка модуля не обновляет существующие экземпляры классов. Когда создается экземпляр класса, он хранит ссылку на объект класса в тот момент. Перезагрузка модуля создает новый объект класса, но существующие экземпляры по-прежнему ссылаются на старый объект класса.

12. Вы также можете наблюдать другие необычные поведения:
    Мы можем дополнительно наблюдать ограничения перезагрузки модулей, используя функцию `isinstance()`. Эта функция проверяет, является ли объект экземпляром определенного класса. После перезагрузки модуля мы увидим, что старый экземпляр `s` больше не считается экземпляром нового класса `simplemod.Spam`, в то время как новый экземпляр `t` считается.

```python
>>> isinstance(s, simplemod.Spam)
False
>>> isinstance(t, simplemod.Spam)
True
```

Это показывает, что после перезагрузки `simplemod.Spam` ссылается на другой объект класса, чем тот, который был использован для создания `s`.

Эти ограничения делают перезагрузку модулей полезной в основном для разработки и отладки, но не рекомендуют использовать ее в продакшн - коде. В продакшн - среде важно обеспечить, чтобы все экземпляры класса использовали одну и ту же, актуальную реализацию. Перезагрузка модулей может привести к неконсистентному поведению, которое может быть трудно отлаживать и поддерживать.
