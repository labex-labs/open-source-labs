# Создание пользовательских дескрипторов

На этом этапе мы создадим собственный класс дескриптора. Но сначала разберемся, что такое дескриптор. Дескриптор - это объект Python, реализующий протокол дескрипторов, состоящий из методов `__get__`, `__set__` и `__delete__`. Эти методы позволяют дескриптору управлять доступом к атрибуту, его установкой и удалением. Создав собственный класс дескриптора, мы сможем лучше понять, как работает этот протокол.

Создайте новый файл с именем `descrip.py` в директории проекта. Этот файл будет содержать наш пользовательский класс дескриптора. Вот код:

```python
# descrip.py

class Descriptor:
    def __init__(self, name):
        self.name = name

    def __get__(self, instance, cls):
        print(f'{self.name}:__get__')
        # In a real descriptor, you would return a value here

    def __set__(self, instance, value):
        print(f'{self.name}:__set__ {value}')
        # In a real descriptor, you would store the value here

    def __delete__(self, instance):
        print(f'{self.name}:__delete__')
        # In a real descriptor, you would delete the value here
```

В классе `Descriptor` метод `__init__` инициализирует дескриптор с именем. Метод `__get__` вызывается при доступе к атрибуту, метод `__set__` - при установке атрибута, а метод `__delete__` - при удалении атрибута.

Теперь создадим тестовый файл, чтобы поэкспериментировать с нашим пользовательским дескриптором. Это поможет нам увидеть, как дескриптор ведет себя в различных сценариях. Создайте файл с именем `test_descrip.py` со следующим кодом:

```python
# test_descrip.py

from descrip import Descriptor

class Foo:
    a = Descriptor('a')
    b = Descriptor('b')
    c = Descriptor('c')

# Create an instance and try accessing the attributes
if __name__ == '__main__':
    f = Foo()
    print("Accessing attribute f.a:")
    f.a

    print("\nAccessing attribute f.b:")
    f.b

    print("\nSetting attribute f.a = 23:")
    f.a = 23

    print("\nDeleting attribute f.a:")
    del f.a
```

В файле `test_descrip.py` мы импортируем класс `Descriptor` из файла `descrip.py`. Затем создаем класс `Foo` с тремя атрибутами `a`, `b` и `c`, каждый из которых управляется дескриптором. Создаем экземпляр класса `Foo` и выполняем такие операции, как доступ к атрибутам, их установка и удаление, чтобы увидеть, как вызываются методы дескриптора.

Теперь запустим этот тестовый файл, чтобы увидеть, как работают дескрипторы на практике. Откройте терминал, перейдите в директорию проекта и запустите тестовый файл с помощью следующих команд:

```bash
cd ~/project
python3 test_descrip.py
```

Вы должны увидеть такой вывод:

```
Accessing attribute f.a:
a:__get__

Accessing attribute f.b:
b:__get__

Setting attribute f.a = 23:
a:__set__ 23

Deleting attribute f.a:
a:__delete__
```

Как вы можете видеть, каждый раз, когда вы обращаетесь к атрибуту, управляемому дескриптором, устанавливаете его значение или удаляете, вызывается соответствующий магический метод (`__get__`, `__set__` или `__delete__`).

Давайте также проверим наш дескриптор в интерактивном режиме. Это позволит нам протестировать дескриптор в реальном времени и сразу увидеть результаты. Откройте терминал, перейдите в директорию проекта и запустите интерактивную сессию Python с файлом `descrip.py`:

```bash
cd ~/project
python3 -i descrip.py
```

Теперь введите следующие команды в интерактивной сессии Python, чтобы увидеть, как работает протокол дескрипторов:

```python
class Foo:
    a = Descriptor('a')
    b = Descriptor('b')
    c = Descriptor('c')

f = Foo()
f.a         # Should call __get__
f.b         # Should call __get__
f.a = 23    # Should call __set__
del f.a     # Should call __delete__
exit()
```

Основная идея здесь заключается в том, что дескрипторы предоставляют способ перехватывать и настраивать доступ к атрибутам. Это делает их мощными инструментами для реализации валидации данных, вычисляемых атрибутов и других продвинутых поведений. Используя дескрипторы, вы можете лучше контролировать, как к атрибутам вашего класса осуществляется доступ, как они устанавливаются и удаляются.
