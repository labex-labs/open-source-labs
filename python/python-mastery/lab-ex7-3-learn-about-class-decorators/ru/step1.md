# Реализация проверки типов с помощью дескрипторов

На этом этапе мы создадим класс `Stock`, который использует дескрипторы для проверки типов. Но сначала давайте разберемся, что такое дескрипторы. Дескрипторы — это очень мощная функция в Python. Они дают вам контроль над тем, как атрибуты доступны в классах.

Дескрипторы — это объекты, которые определяют, как атрибуты доступны в других объектах. Они делают это, реализуя специальные методы, такие как `__get__`, `__set__` и `__delete__`. Эти методы позволяют дескрипторам управлять тем, как атрибуты извлекаются, устанавливаются и удаляются. Дескрипторы очень полезны для реализации валидации, проверки типов и вычисляемых свойств. Например, вы можете использовать дескриптор, чтобы убедиться, что атрибут всегда является положительным числом или строкой определенного формата.

Файл `validate.py` уже содержит классы валидаторов (`String`, `PositiveInteger`, `PositiveFloat`). Мы можем использовать эти классы для валидации атрибутов нашего класса `Stock`.

Теперь давайте создадим наш класс `Stock` с дескрипторами.

1. Сначала откройте файл `stock.py` в вашем редакторе.

2. После открытия файла замените содержимое-заполнитель следующим кодом:

```python
# stock.py

from structure import Structure
from validate import String, PositiveInteger, PositiveFloat

class Stock(Structure):
    _fields = ('name', 'shares', 'price')
    name = String()
    shares = PositiveInteger()
    price = PositiveFloat()

    @property
    def cost(self):
        return self.shares * self.price

    def sell(self, nshares):
        self.shares -= nshares

# Create an __init__ method based on _fields
Stock.create_init()
```

Давайте разберем, что делает этот код. Кортеж `_fields` определяет атрибуты класса `Stock`. Это имена атрибутов, которые будут у объектов `Stock`.

Атрибуты `name`, `shares` и `price` определены как объекты дескрипторов. Дескриптор `String()` гарантирует, что атрибут `name` является строкой. Дескриптор `PositiveInteger()` гарантирует, что атрибут `shares` является положительным целым числом. А дескриптор `PositiveFloat()` гарантирует, что атрибут `price` является положительным числом с плавающей запятой.

Свойство `cost` является вычисляемым свойством. Оно рассчитывает общую стоимость акции на основе количества акций и цены за акцию.

Метод `sell` используется для уменьшения количества акций. Когда вы вызываете этот метод с количеством продаваемых акций, он вычитает это количество из атрибута `shares`.

Строка `Stock.create_init()` динамически создает метод `__init__` для нашего класса. Этот метод позволяет нам создавать объекты `Stock`, передавая значения для атрибутов `name`, `shares` и `price`.

3. После добавления кода сохраните файл. Это гарантирует, что ваши изменения будут сохранены и могут быть использованы при запуске тестов.

4. Теперь давайте запустим тесты, чтобы проверить вашу реализацию. Сначала перейдите в каталог `~/project`, выполнив следующую команду:

```bash
cd ~/project
```

Затем запустите тесты, используя следующую команду:

```bash
python3 teststock.py
```

Если ваша реализация верна, вы увидите вывод, похожий на этот:

```
.........
----------------------------------------------------------------------
Ran 9 tests in 0.001s

OK
```

Этот вывод означает, что все тесты пройдены. Дескрипторы успешно проверяют типы каждого атрибута!

Давайте попробуем создать объект `Stock` в интерпретаторе Python. Сначала убедитесь, что вы находитесь в каталоге `~/project`. Затем выполните следующую команду:

```bash
cd ~/project
python3 -c "from stock import Stock; s = Stock('GOOG', 100, 490.1); print(s); print(f'Cost: {s.cost}')"
```

Вы должны увидеть следующий вывод:

```
Stock('GOOG', 100, 490.1)
Cost: 49010.0
```

Вы успешно реализовали дескрипторы для проверки типов! Теперь давайте улучшим этот код дальше.
