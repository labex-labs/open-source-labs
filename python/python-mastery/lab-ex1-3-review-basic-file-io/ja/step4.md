# プログラムの完成

ここでは、コードを整理し、`pcost.py` プログラムの最終版を作成します。コードを整理するとは、不要な部分を削除し、出力が見やすくなるようにすることです。これは、コードをよりプロフェッショナルで理解しやすくするため、プログラミングにおいて重要なステップです。

まず、デバッグ用の print 文を削除します。これらの文は開発中に変数の値やプログラムの流れを確認するために使用されますが、最終版では必要ありません。次に、最終的な出力がきれいに整形されるようにします。

以下が `pcost.py` コードの最終版です。

```python
# pcost.py
# 株式ポートフォリオの総コストを計算する

def portfolio_cost(filename):
    """
    ポートフォリオファイルの総コスト (株式数*価格) を計算する
    """
    total_cost = 0.0

    try:
        # ファイルを開く
        with open(filename, 'r') as file:
            # ファイル内のすべての行を読み取る
            for line in file:
                # 先頭と末尾の空白を削除する
                line = line.strip()

                # 空行をスキップする
                if not line:
                    continue

                # 行をフィールドに分割する
                fields = line.split()

                # 関連するデータを抽出する
                # fields[0] は株式シンボル (計算には必要ない)
                shares = int(fields[1])  # 株式数 (2 番目のフィールド)
                price = float(fields[2])  # 1 株あたりの価格 (3 番目のフィールド)

                # この株式購入のコストを計算し、総コストに追加する
                total_cost += shares * price

    except FileNotFoundError:
        print(f"エラー: ファイル '{filename}' が見つかりませんでした")
        return 0.0
    except Exception as e:
        print(f"ファイルの処理時にエラーが発生しました: {e}")
        return 0.0

    # 総コストを返す
    return total_cost

# スクリプトが直接実行されたときに実行されるメインブロック
if __name__ == '__main__':
    # ポートフォリオファイルを引数にして関数を呼び出す
    total_cost = portfolio_cost('portfolio.dat')
    print(f'総コスト: ${total_cost:.2f}')
```

このコードの最終版にはいくつかの改善点があります。

1. エラーハンドリング: 2 種類のエラーを捕捉するコードを追加しました。指定されたファイルが存在しない場合、`FileNotFoundError` が発生します。この場合、プログラムはエラーメッセージを表示し、0.0 を返します。`Exception` ブロックは、ファイルの処理時に発生する可能性のある他のエラーを捕捉します。これにより、プログラムがより堅牢になり、予期せずクラッシュする可能性が低くなります。
2. 適切な整形: 総コストは、f-string 内の `:.2f` フォーマット指定子を使用して小数点以下 2 桁に整形されます。これにより、出力がよりプロフェッショナルで読みやすくなります。
3. `__name__ == '__main__'` チェック: これは一般的な Python の慣用句です。これにより、`if` ブロック内のコードは、スクリプトが直接実行されたときにのみ実行されます。スクリプトが別のスクリプトにモジュールとしてインポートされた場合、このコードは実行されません。これにより、スクリプトの動作をより細かく制御できます。

それでは、最終コードを実行しましょう。ターミナルを開き、以下のコマンドを入力します。

```bash
python3 ~/project/pcost.py
```

このコマンドを実行すると、プログラムは `portfolio.dat` ファイルを読み取り、ポートフォリオの総コストを計算し、結果を表示します。ポートフォリオの総コストが表示されるはずで、その値は $44671.15 です。

おめでとうございます！ファイルからデータを読み取り、処理し、結果を計算する Python プログラムを成功させました。これは素晴らしい成果であり、あなたが熟練した Python プログラマーの道を歩んでいることを示しています。
