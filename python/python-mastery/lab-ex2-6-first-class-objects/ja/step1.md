# Pythonにおける第一級オブジェクトの理解

Pythonでは、すべてがオブジェクトとして扱われます。これには関数や型も含まれます。これはどういう意味でしょうか？つまり、関数や型をデータ構造に格納したり、他の関数に引数として渡したり、さらには他の関数から返すこともできるということです。これは非常に強力な概念であり、ここではCSVデータ処理を例にして探索していきます。

## 第一級型の探索

まず、Pythonインタープリタを起動しましょう。WebIDEで新しいターミナルを開き、以下のコマンドを入力します。このコマンドでPythonインタープリタが起動し、ここでPythonコードを実行します。

```bash
python3
```

PythonでCSVファイルを扱う際、これらのファイルから読み取った文字列を適切なデータ型に変換する必要があることがよくあります。たとえば、CSVファイル内の数値は文字列として読み取られるかもしれませんが、Pythonコードでは整数または浮動小数点数として使用したいと思うでしょう。これを行うには、変換関数のリストを作成することができます。

```python
coltypes = [str, int, float]
```

ここでは、実際の型関数を含むリストを作成していることに注意してください。文字列ではありません。Pythonでは、型は第一級オブジェクトであり、他のオブジェクトと同じように扱うことができます。リストに入れたり、渡したり、コードで使用したりすることができます。

では、ポートフォリオのCSVファイルからいくつかのデータを読み取り、これらの変換関数をどのように使用できるかを見てみましょう。

```python
import csv
f = open('portfolio.csv')
rows = csv.reader(f)
headers = next(rows)
row = next(rows)
print(row)
```

このコードを実行すると、以下のような出力が表示されるはずです。これはCSVファイルの最初のデータ行で、文字列のリストとして表されています。

```
['AA', '100', '32.20']
```

次に、`zip`関数を使用します。`zip`関数は、複数のイテラブル（リストやタプルなど）を受け取り、それらの要素をペアにします。これを使用して、行の各値を対応する型変換関数とペアにします。

```python
r = list(zip(coltypes, row))
print(r)
```

これにより、以下のような出力が得られます。各ペアには、型関数とCSVファイルからの文字列値が含まれています。

```
[(<class 'str'>, 'AA'), (<class 'int'>, '100'), (<class 'float'>, '32.20')]
```

これらのペアができたので、各関数を適用して値を適切な型に変換することができます。

```python
record = [func(val) for func, val in zip(coltypes, row)]
print(record)
```

出力では、値が適切な型に変換されていることがわかります。文字列 'AA' は文字列のまま、'100' は整数 100 に、'32.20' は浮動小数点数 32.2 になります。

```
['AA', 100, 32.2]
```

また、これらの値を列名と組み合わせて辞書を作成することもできます。辞書は、キーと値のペアを格納できる便利なデータ構造です。

```python
record_dict = dict(zip(headers, record))
print(record_dict)
```

出力は、キーが列名で値が変換されたデータである辞書になります。

```
{'name': 'AA', 'shares': 100, 'price': 32.2}
```

これらの手順をすべて1つの内包表記で行うこともできます。内包表記は、Pythonでリスト、辞書、またはセットを簡潔に作成する方法です。

```python
result = {name: func(val) for name, func, val in zip(headers, coltypes, row)}
print(result)
```

出力は前と同じ辞書になります。

```
{'name': 'AA', 'shares': 100, 'price': 32.2}
```

Pythonインタープリタでの作業が終了したら、以下のコマンドを入力して終了できます。

```python
exit()
```

このデモンストレーションは、Pythonが関数を第一級オブジェクトとして扱うことで、強力なデータ処理技術が可能になることを示しています。型や関数をオブジェクトとして扱えることで、より柔軟で簡潔なコードを書くことができます。
