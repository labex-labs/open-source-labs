# Создание вспомогательной функции для обработки CSV

Теперь, когда мы понимаем, как объекты первого класса в Python могут помочь нам с преобразованием данных, мы создадим переиспользуемую вспомогательную функцию. Эта функция будет считывать данные из CSV-файла и преобразовывать их в список словарей. Это очень полезная операция, так как CSV-файлы обычно используются для хранения табличных данных, и преобразование их в список словарей упрощает работу с данными в Python.

## Создание вспомогательной функции для чтения CSV

Сначала откройте WebIDE. После открытия перейдите в директорию проекта и создайте новый файл с именем `reader.py`. В этом файле мы определим функцию, которая считывает данные из CSV-файла и применяет преобразования типов. Преобразования типов важны, так как данные в CSV-файле обычно считываются как строки, но для дальнейшей обработки нам могут понадобиться другие типы данных, такие как целые числа или числа с плавающей точкой.

Добавьте следующий код в файл `reader.py`:

```python
import csv

def read_csv_as_dicts(filename, types):
    """
    Read a CSV file into a list of dictionaries, converting each field according
    to the types provided.

    Parameters:
    filename (str): Name of the CSV file to read
    types (list): List of type conversion functions for each column

    Returns:
    list: List of dictionaries representing the CSV data
    """
    records = []
    with open(filename, 'r') as f:
        rows = csv.reader(f)
        headers = next(rows)  # Get the column headers

        for row in rows:
            # Apply type conversions to each value in the row
            converted_row = [func(val) for func, val in zip(types, row)]

            # Create a dictionary mapping headers to converted values
            record = dict(zip(headers, converted_row))
            records.append(record)

    return records
```

Эта функция сначала открывает указанный CSV-файл. Затем она считывает заголовки CSV-файла, которые являются именами столбцов. После этого она проходит по каждой строке в файле. Для каждого значения в строке она применяет соответствующую функцию преобразования типа из списка `types`. Наконец, она создает словарь, в котором ключами являются заголовки столбцов, а значениями - преобразованные данные, и добавляет этот словарь в список `records`. После обработки всех строк функция возвращает список `records`.

## Тестирование вспомогательной функции

Протестируем нашу вспомогательную функцию. Сначала откройте терминал и запустите интерпретатор Python, введя:

```bash
python3
```

Теперь, находясь в интерпретаторе Python, мы можем использовать нашу функцию для чтения данных о портфеле. Данные о портфеле хранятся в CSV-файле и содержат информацию о акциях, такую как название акции, количество акций и цена.

```python
import reader
portfolio = reader.read_csv_as_dicts('portfolio.csv', [str, int, float])
for record in portfolio[:3]:  # Show the first 3 records
    print(record)
```

При запуске этого кода вы должны увидеть вывод, похожий на следующий:

```
{'name': 'AA', 'shares': 100, 'price': 32.2}
{'name': 'IBM', 'shares': 50, 'price': 91.1}
{'name': 'CAT', 'shares': 150, 'price': 83.44}
```

Этот вывод показывает первые три записи из данных о портфеле с правильно преобразованными типами данных.

Попробуем также использовать нашу функцию с данными о автобусах CTA. Данные о автобусах CTA хранятся в другом CSV-файле и содержат информацию о маршрутах автобусов, датах, типах дней и количестве поездок.

```python
rows = reader.read_csv_as_dicts('ctabus.csv', [str, str, str, int])
print(f"Total rows: {len(rows)}")
print("First row:", rows[0])
```

Вывод должен быть похожим на следующий:

```
Total rows: 577563
First row: {'route': '3', 'date': '01/01/2001', 'daytype': 'U', 'rides': 7354}
```

Это показывает, что наша функция может обрабатывать разные CSV-файлы и применять соответствующие преобразования типов.

Чтобы выйти из интерпретатора Python, введите:

```python
exit()
```

Теперь вы создали переиспользуемую вспомогательную функцию, которая может считывать любой CSV-файл и применять соответствующие преобразования типов. Это демонстрирует мощь объектов первого класса в Python и то, как их можно использовать для создания гибкого и переиспользуемого кода.
