# Использование `__slots__` для оптимизации памяти

В Python атрибут `__slots__` представляет собой специальный инструмент, который может помочь более эффективно управлять классами. Он ограничивает набор атрибутов, которые класс может иметь. Обычно Python хранит атрибуты экземпляра в словаре с именем `__dict__`, что позволяет динамически добавлять новые атрибуты. Однако, когда вы определяете `__slots__`, Python создает статическую структуру для экземпляров. Это имеет два основных эффекта: оно предотвращает добавление новых атрибутов к экземплярам и уменьшает использование памяти, так как не нужно поддерживать `__dict__`.

В нашем классе `Stock` мы будем использовать `__slots__` по двум важным причинам:

1. Чтобы ограничить создание атрибутов только теми, которые мы определили. Это означает, что пользователи класса не смогут случайно или намеренно добавить новые атрибуты, которые мы не предусмотрели.
2. Чтобы повысить эффективность использования памяти, особенно при создании большого количества экземпляров. Если у вас есть большое количество объектов класса `Stock`, использование `__slots__` может сэкономить значительное количество памяти.

## Инструкции:

1. Сначала вам нужно открыть файл `stock.py` в редакторе. Именно здесь мы будем вносить изменения в класс `Stock`. Используйте следующую команду в терминале:

   ```bash
   code /home/labex/project/stock.py
   ```

2. Внутри файла `stock.py` мы добавим переменную класса `__slots__`. Эта переменная должна перечислять все имена приватных атрибутов, используемых классом. Вот как это сделать:

   ```python
   class Stock:
       # Class variable for type conversions
       _types = (str, int, float)

       # Define slots to restrict attribute creation
       __slots__ = ('name', '_shares', '_price')

       # Rest of the class...
   ```

   Определив `__slots__` таким образом, мы сообщаем Python, что экземпляры класса `Stock` могут иметь только атрибуты `name`, `_shares` и `_price`.

3. После внесения этих изменений сохраните файл. Это гарантирует, что ваши изменения будут сохранены.

4. Теперь нам нужно создать тестовый скрипт, чтобы убедиться, что `__slots__` работает как ожидается. Откройте новый файл с именем `test_slots.py` с помощью следующей команды:

   ```bash
   code /home/labex/project/test_slots.py
   ```

5. Добавьте следующий код в файл `test_slots.py`. Этот код создаст экземпляр класса `Stock`, обратится к его существующим атрибутам, а затем попытается добавить новый атрибут.

   ```python
   from stock import Stock

   # Create a stock instance
   s = Stock('GOOG', 100, 490.10)

   # Access existing attributes
   print(f"Name: {s.name}")
   print(f"Shares: {s.shares}")
   print(f"Price: {s.price}")
   print(f"Cost: {s.cost}")

   # Try to add a new attribute
   try:
       s.extra = "This will fail"
       print(f"Extra: {s.extra}")
   except AttributeError as e:
       print(f"Error: {e}")
   ```

   Блок `try` пытается добавить новый атрибут `extra` к экземпляру `s` класса `Stock`. Если `__slots__` работает правильно, это должно вызвать исключение `AttributeError`, так как `extra` не перечислен в `__slots__`.

6. Наконец, запустите тестовый скрипт с помощью следующей команды:
   ```bash
   python /home/labex/project/test_slots.py
   ```

Вы должны увидеть вывод, показывающий, что вы можете обращаться к определенным атрибутам, но попытка добавить новый атрибут вызывает исключение `AttributeError`. Это подтверждает, что `__slots__` работает как задумано.

### Понимание `__slots__`

При использовании `__slots__` важно помнить следующие моменты:

1. Вы должны перечислить все атрибуты, которые будут храниться в экземпляре. Если вы забудете перечислить атрибут, вы не сможете присвоить его экземпляру.
2. Только атрибуты, перечисленные в `__slots__`, могут быть присвоены экземплярам. Это помогает обеспечить строгую структуру для ваших объектов.
3. Экземпляры больше не будут иметь атрибута `__dict__`. Поскольку `__slots__` создает статическую структуру, нет необходимости в динамическом словаре.
4. Подклассы не наследуют `__slots__` своих родителей, если они не определяют свои собственные `__slots__`. Это означает, что подклассы имеют возможность определить свои собственные ограничения на атрибуты.

Основные преимущества использования `__slots__` следующие:

1. **Эффективность использования памяти**: Экземпляры используют меньше памяти, так как нет `__dict__` для хранения атрибутов.
2. **Скорость**: Обращение к атрибутам происходит немного быстрее, так как Python не нужно искать атрибут в словаре.
3. **Предотвращение случайного создания атрибутов**: Помогает обнаружить опечатки и ошибки в программировании, предотвращая добавление непредвиденных атрибутов.
