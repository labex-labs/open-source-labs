# Предварительное вычисление матрицы Грама с взвешенными выборками

Чтобы обучить эластичную сеть с использованием параметра `precompute` вместе с весами выборок, необходимо сначала центрировать матрицу признаков и перемасштабировать ее по нормализованным весам перед вычислением матрицы Грама. Центрируем матрицу признаков, вычитая из каждой строки взвешенное среднее каждого столбца признаков. Затем перемасштабируем центрированную матрицу признаков, умножая каждую строку на квадратный корень соответствующего нормализованного веса. Наконец, вычисляем матрицу Грама, взяв скалярное произведение перемасштабированной матрицы признаков на ее транспонированную матрицу.

```python
X_offset = np.average(X, axis=0, weights=normalized_weights)
X_centered = X - np.average(X, axis=0, weights=normalized_weights)
X_scaled = X_centered * np.sqrt(normalized_weights)[:, np.newaxis]
gram = np.dot(X_scaled.T, X_scaled)
```
