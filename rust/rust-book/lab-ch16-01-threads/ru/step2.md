# Создание нового потока с помощью spawn

Для создания нового потока мы вызываем функцию `thread::spawn` и передаем ей замыкание (мы говорили о замыканиях в главе 13), содержащее код, который мы хотим запустить в новом потоке. Пример в листинге 16-1 выводит некоторый текст из главного потока и другой текст из нового потока.

Имя файла: `src/main.rs`

```rust
use std::thread;
use std::time::Duration;

fn main() {
    thread::spawn(|| {
        for i in 1..10 {
            println!("hi number {i} from the spawned thread!");
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..5 {
        println!("hi number {i} from the main thread!");
        thread::sleep(Duration::from_millis(1));
    }
}
```

Листинг 16-1: Создание нового потока для вывода одной вещи, в то время как главный поток выводит что-то другое

Обратите внимание, что когда главный поток Rust программы завершается, все созданные потоки завершаются, независимо от того, закончили ли они выполняться. Вывод из этой программы может быть немного разным каждый раз, но будет похож на следующий:

    hi number 1 from the main thread!
    hi number 1 from the spawned thread!
    hi number 2 from the main thread!
    hi number 2 from the spawned thread!
    hi number 3 from the main thread!
    hi number 3 from the spawned thread!
    hi number 4 from the main thread!
    hi number 4 from the spawned thread!
    hi number 5 from the spawned thread!

Вызовы `thread::sleep` заставляют поток остановить свое выполнение на короткое время, позволяя другому потоку запуститься. Вероятно, потоки будут чередоваться, но это не гарантируется: зависит от того, как ваша операционная система планирует потоки. В этом запуске главный поток вывел первый, хотя инструкция вывода из созданного потока появляется первой в коде. И хотя мы сказали созданному потоку выводить до тех пор, пока `i` не станет равным 9, он успел вывести только до 5, прежде чем главный поток завершился.

Если вы запустите этот код и увидите только вывод из главного потока или не увидите никакого перекрытия, попробуйте увеличить числа в диапазонах, чтобы создать больше возможностей для операционной системы переключаться между потоками.
