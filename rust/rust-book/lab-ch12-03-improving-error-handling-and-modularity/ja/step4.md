# 構成値のグループ化

`parse_config`関数をさらに改善するために、もう少し小さなステップを踏みましょう。現在、タプルを返していますが、その後すぐにそのタプルを再び個々の部分に分割しています。これは、まだ正しい抽象化ができていないことの兆候です。

改善の余地があることを示すもう一つの指標は、`parse_config`の`config`部分です。これは、返す 2 つの値が関連しており、両方とも 1 つの構成値の一部であることを意味します。現在、データの構造では、2 つの値をタプルにグループ化する以外に、この意味を伝えていません。代わりに、2 つの値を 1 つの構造体に入れ、構造体の各フィールドに意味のある名前を付けます。これにより、このコードの将来の保守担当者が、異なる値がどのように関連しているか、そしてそれらの目的が何かを理解するのが容易になります。

リスト 12-6 は、`parse_config`関数の改善点を示しています。

ファイル名：`src/main.rs`

```rust
fn main() {
    let args: Vec<String> = env::args().collect();

  1 let config = parse_config(&args);

    println!("Searching for {}", 2 config.query);
    println!("In file {}", 3 config.file_path);

    let contents = fs::read_to_string(4 config.file_path)
       .expect("Should have been able to read the file");

    --snip--
}

5 struct Config {
    query: String,
    file_path: String,
}

6 fn parse_config(args: &[String]) -> Config {
  7 let query = args[1].clone();
  8 let file_path = args[2].clone();

    Config { query, file_path }
}
```

リスト 12-6: `parse_config`を再構築して`Config`構造体のインスタンスを返す

`query`と`file_path`という名前のフィールドを持つように定義された`Config`という名前の構造体を追加しました\[5\]。`parse_config`のシグネチャは、現在、`Config`値を返すことを示しています\[6\]。`parse_config`の本体では、以前は`args`内の`String`値を参照する文字列スライスを返していましたが、今では`Config`を定義して所有する`String`値を含めるようにしました。`main`内の`args`変数は引数値の所有者であり、`parse_config`関数にのみ借りて使用させています。これは、`Config`が`args`内の値の所有権を取得しようとすると、Rust の借用規則に違反することを意味します。

`String`データを管理する方法はいくつかありますが、最も簡単ですが多少非効率的な方法は、値に対して`clone`メソッドを呼び出すことです\[7\] \[8\]。これにより、`Config`インスタンスが所有するデータの完全なコピーが作成され、文字列データへの参照を格納するよりも時間とメモリが多く必要になります。ただし、データをクローンすることでコードが非常に単純になります。なぜなら、参照の生存時間を管理する必要がないからです。このような状況では、単純さを得るために少しのパフォーマンスを犠牲にするのは価値のあるトレードオフです。

> **clone を使用するトレードオフ**
>
> 多くの Rust プログラマーは、実行時のコストのために、所有権の問題を解決するために`clone`を使用することを避ける傾向があります。13 章では、この種の状況でより効率的な方法を学びます。しかし、今のところ、進歩を続けるためにいくつかの文字列をコピーすることは大丈夫です。なぜなら、これらのコピーは一度だけ行い、ファイルパスとクエリ文字列は非常に小さいからです。最初の段階でコードを超最適化しようとするよりも、少し非効率的な稼働プログラムを持つ方が良いです。Rust に慣れるにつれて、最も効率的なソリューションから始めることが容易になりますが、今のところ、`clone`を呼び出すことは完全に許容されます。

`main`を更新して、`parse_config`が返す`Config`のインスタンスを`config`という名前の変数に格納し\[1\]、以前は個別の`query`と`file_path`変数を使用していたコードを更新して、現在は代わりに`Config`構造体のフィールドを使用するようにしました\[2\] \[3\] \[4\]。

今では、コードがより明確に伝えているのは、`query`と`file_path`が関連しており、それらの目的はプログラムの動作方法を構成することであるということです。これらの値を使用するコードは、目的に応じた名前のフィールドの`config`インスタンスからそれらを見つけることを知っています。
