# モジューラリティとエラーハンドリングの改善のためのリファクタリング

プログラムを改善するために、プログラムの構造と潜在的なエラーの処理方法に関係する 4 つの問題を修正します。まず、`main`関数は現在 2 つのタスクを実行しています。引数を解析し、ファイルを読み取ります。プログラムが拡大するにつれて、`main`関数が処理する個別のタスクの数が増えます。関数が責任を担うようになると、推論しにくくなり、テストしにくくなり、一部を破壊することなく変更しにくくなります。機能を分離するのが最善で、各関数は 1 つのタスクに責任を持つようにします。

この問題はまた、2 番目の問題にも関係しています。`query`と`file_path`はプログラムの構成変数ですが、`contents`のような変数はプログラムのロジックを実行するために使用されます。`main`が長くなるほど、スコープに持ち込む必要のある変数が増えます。スコープ内にある変数が多いほど、各変数の目的を把握するのが難しくなります。構成変数を 1 つの構造体にグループ化して目的を明確にするのが最善です。

3 番目の問題は、ファイルの読み取りに失敗したときに`expect`を使用してエラーメッセージを表示していますが、エラーメッセージはただ`Should have been able to read the file`と表示されます。ファイルの読み取りに失敗する場合がいくつかあります。たとえば、ファイルが存在しない場合や、それを開く権限がない場合などです。現在のところ、状況に関係なく、すべてに同じエラーメッセージを表示しており、ユーザーには何の情報も与えていません！

4 番目の問題は、異なるエラーを処理するために`expect`を繰り返し使用していることです。ユーザーが十分な引数を指定せずにプログラムを実行すると、Rust から`index out of bounds`エラーが表示されますが、これは問題を明確に説明していません。エラーハンドリングロジックを変更する必要がある場合、すべてのエラーハンドリングコードを 1 か所にまとめておくと、将来の保守担当者がコードを参照する場所が 1 か所だけになるため最適です。すべてのエラーハンドリングコードを 1 か所にまとめることで、最終ユーザーにとって意味のあるメッセージを表示することも保証されます。

これらの 4 つの問題に対処するために、プロジェクトをリファクタリングしましょう。
