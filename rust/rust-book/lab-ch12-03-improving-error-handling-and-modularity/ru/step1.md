# Refactoring to Improve Modularity and Error Handling

Для улучшения нашей программы мы исправим четыре проблемы, связанные с структурой программы и ее способом обработки потенциальных ошибок. Во - первых, наша функция `main` сейчас выполняет две задачи: она разбирает аргументы и читает файлы. По мере роста нашей программы количество отдельных задач, которые обрабатывает функция `main`, будет увеличиваться. Чем больше функция берет на себя ответственностей, тем труднее становится понять ее работу, тестировать ее и изменять, не сломав что - то из ее частей. Лучше разделить функциональность, чтобы каждая функция была ответственна за одну задачу.

Эта проблема также связана со второй проблемой: хотя `query` и `file_path` являются переменными конфигурации нашей программы, переменные типа `contents` используются для выполнения логики программы. Чем длиннее становится `main`, тем больше переменных нам нужно будет внести в область видимости; чем больше переменных в области видимости, тем труднее будет следить за назначением каждой из них. Лучше сгруппировать переменные конфигурации в одну структуру, чтобы их назначение было ясным.

Третья проблема заключается в том, что мы использовали `expect` для вывода сообщения об ошибке, когда чтение файла завершается неудачей, но сообщение об ошибке просто выводит `Should have been able to read the file`. Чтение файла может завершиться неудачей по ряду причин: например, файл может отсутствовать, или у нас может не быть разрешения на его открытие. В настоящее время независимо от ситуации мы выводим одно и то же сообщение об ошибке для всего, что не дает пользователю никакой информации!

Четвертая проблема - это то, что мы повторно используем `expect` для обработки различных ошибок, и если пользователь запустит нашу программу без указания достаточного количества аргументов, он получит ошибку `index out of bounds` от Rust, которая неясно объясняет проблему. Лучше, если весь код обработки ошибок будет в одном месте, чтобы будущие разработчики имели только одно место для обращения, если нужно изменить логику обработки ошибок. Сбор всех кода обработки ошибок в одном месте также обеспечит вывод сообщений, которые будут понятны нашим конечным пользователям.

Поправим эти четыре проблемы, рефакторируя наш проект.
