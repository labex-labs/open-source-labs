# Создание провального теста для функции нечувствительного к регистру поиска

Сначала мы добавим новую функцию `search_case_insensitive`, которая будет вызываться, когда переменная окружения имеет значение. Мы продолжим следовать процессу TDD, поэтому первый шаг — снова написать провальный тест. Мы добавим новый тест для новой функции `search_case_insensitive` и переименуем старый тест из `one_result` в `case_sensitive`, чтобы прояснить различия между двумя тестами, как показано в Listing 12-20.

Имя файла: `src/lib.rs`

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn case_sensitive() {
        let query = "duct";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.
Duct tape.";

        assert_eq!(
            vec!["safe, fast, productive."],
            search(query, contents)
        );
    }

    #[test]
    fn case_insensitive() {
        let query = "rUsT";
        let contents = "\
Rust:
safe, fast, productive.
Pick three.
Trust me.";

        assert_eq!(
            vec!["Rust:", "Trust me."],
            search_case_insensitive(query, contents)
        );
    }
}
```

Listing 12-20: Добавление нового провального теста для функции нечувствительного к регистру, которую мы собираемся добавить

Обратите внимание, что мы также отредактировали содержимое старого теста. Мы добавили новую строку с текстом `"Duct tape."` с заглавной буквой _D_, которая не должна совпадать с запросом `"duct"` при поиске в чувствительности к регистру. Изменение старого теста таким образом помогает убедиться, что мы не случайно не сломаем функциональность чувствительного к регистру поиска, которую мы уже реализовали. Этот тест должен пройти сейчас и должен продолжать проходить при работе над нечувствительным к регистру поиском.

Новый тест для нечувствительного к регистру поиска использует `"rUsT"` в качестве запроса. В функции `search_case_insensitive`, которую мы собираемся добавить, запрос `"rUsT"` должен совпадать с строкой, содержащей `"Rust:"` с заглавной буквой _R_, и совпадать с строкой `"Trust me."`, хотя обе имеют разный регистр по сравнению с запросом. Это наш провальный тест, и он не скомпилируется, потому что мы еще не определили функцию `search_case_insensitive`. Не стесняйтесь добавить скелетную реализацию, которая всегда возвращает пустой вектор, аналогично тому, как мы это сделали для функции `search` в Listing 12-16, чтобы увидеть, как тест скомпилируется и упадет.
