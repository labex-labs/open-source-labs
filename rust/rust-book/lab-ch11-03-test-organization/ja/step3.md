# テストモジュールと #\[cfg(test)\]

`tests` モジュールに付けられた `#[cfg(test)]` アノテーションは、Rustに対して、`cargo test` を実行するときのみテストコードをコンパイルして実行し、`cargo build` を実行するときには実行しないように指示します。これにより、ライブラリのみをビルドしたい場合にはコンパイル時間を節約でき、テストが含まれないため、生成されたコンパイル済みアーティファクトのサイズも節約できます。統合テストは別のディレクトリに配置されるため、`#[cfg(test)]` アノテーションは必要ありません。ただし、単体テストはコードと同じファイルに配置されるため、コンパイル結果に含まれないように `#[cfg(test)]` を使用します。

本章の最初のセクションで新しい `adder` プロジェクトを生成したとき、Cargoがこのコードを自動的に生成したことを思い出してください。

ファイル名: `src/lib.rs`

```rust
#[cfg(test)]
mod tests {
    #[test]
    fn it_works() {
        let result = 2 + 2;
        assert_eq!(result, 4);
    }
}
```

このコードは自動生成された `tests` モジュールです。属性 `cfg` は「コンフィギュレーション」を意味し、特定のコンフィギュレーションオプションが与えられた場合のみ、次の項目が含まれるべきであることをRustに伝えます。この場合、コンフィギュレーションオプションは `test` で、Rustによってテストのコンパイルと実行に提供されます。`cfg` 属性を使用することで、Cargoは `cargo test` でテストを積極的に実行した場合にのみ、テストコードをコンパイルします。これには、このモジュール内に含まれる可能性のあるヘルパー関数や、`#[test]` でアノテートされた関数も含まれます。
