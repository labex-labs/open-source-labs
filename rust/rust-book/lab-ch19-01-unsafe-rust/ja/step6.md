# 外部コードを呼び出すためのextern関数の使用

時には、Rustコードが別の言語で書かれたコードと相互作用する必要があります。このために、Rustには`extern`というキーワードがあり、これは「外部関数インターフェイス（FFI: Foreign Function Interface）」の作成と使用を容易にします。FFIは、プログラミング言語が関数を定義し、異なる（外部の）プログラミング言語がそれらの関数を呼び出せるようにする方法です。

リスト19-8は、C標準ライブラリの`abs`関数との統合を設定する方法を示しています。`extern`ブロック内で宣言された関数は、常にRustコードから呼び出すのが不健全です。その理由は、他の言語がRustの規則と保証を強制しないため、Rustはそれらをチェックできず、セーフティを確保する責任はプログラマにあるからです。

ファイル名: `src/main.rs`

```rust
extern "C" {
    fn abs(input: i32) -> i32;
}

fn main() {
    unsafe {
        println!(
            "Absolute value of -3 according to C: {}",
            abs(-3)
        );
    }
}
```

リスト19-8：別の言語で定義された`extern`関数の宣言と呼び出し

`extern "C"`ブロック内では、呼び出したい別の言語の外部関数の名前とシグネチャを列挙します。`"C"`の部分は、外部関数が使用する「アプリケーションバイナリインターフェイス（ABI: Application Binary Interface）」を定義します。ABIは、アセンブリレベルで関数を呼び出す方法を定義します。`"C"` ABIは最も一般的で、Cプログラミング言語のABIに準拠しています。

> **他の言語からRust関数を呼び出す**
>
> また、`extern`を使って、他の言語がRust関数を呼び出せるようなインターフェイスを作成することもできます。全体的な`extern`ブロックを作成する代わりに、`extern`キーワードを追加し、関連する関数の`fn`キーワードの直前に使用するABIを指定します。また、この関数の名前をマングルしないようにRustコンパイラに伝えるために、`#[no_mangle]`アノテーションを追加する必要があります。「マングリング」とは、コンパイラが関数に与えた名前を、コンパイルプロセスの他の部分が消費するためにより多くの情報を含む別の名前に変更することです。ただし、その名前は人間が読みやすくなります。各プログラミング言語のコンパイラは名前をマングルする方法が少し異なるため、他の言語で名前付け可能なRust関数を作成するには、Rustコンパイラの名前マングリングを無効にする必要があります。
>
> 次の例では、`call_from_c`関数をCコードからアクセスできるようにします。この関数は、共有ライブラリにコンパイルされ、Cからリンクされた後に使用できます。
>
>     #[no_mangle]
>     pub extern "C" fn call_from_c() {
>         println!("Just called a Rust function from C!");
>     }
>
> この`extern`の使用には`unsafe`は必要ありません。
