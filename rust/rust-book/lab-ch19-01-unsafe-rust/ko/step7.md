# 가변 정적 변수 접근 또는 수정

이 책에서는 아직 전역 변수에 대해 이야기하지 않았습니다. Rust 는 전역 변수를 지원하지만 Rust 의 소유권 규칙과 관련하여 문제가 발생할 수 있습니다. 두 스레드가 동일한 가변 전역 변수에 접근하는 경우 데이터 경합이 발생할 수 있습니다.

Rust 에서 전역 변수는 _static (정적)_ 변수라고 합니다. Listing 19-9 는 문자열 슬라이스를 값으로 사용하는 정적 변수의 선언 및 사용 예제를 보여줍니다.

Filename: `src/main.rs`

```rust
static HELLO_WORLD: &str = "Hello, world!";

fn main() {
    println!("value is: {HELLO_WORLD}");
}
```

Listing 19-9: 불변 정적 변수 정의 및 사용

정적 변수는 "상수"에서 논의한 상수와 유사합니다. 정적 변수의 이름은 관례적으로 `SCREAMING_SNAKE_CASE`로 표기합니다. 정적 변수는 `'static` 수명을 가진 참조만 저장할 수 있으며, 이는 Rust 컴파일러가 수명을 파악할 수 있고 명시적으로 주석을 달 필요가 없음을 의미합니다. 불변 정적 변수에 접근하는 것은 안전합니다.

상수와 불변 정적 변수의 미묘한 차이점은 정적 변수의 값은 메모리에 고정된 주소를 갖는다는 것입니다. 값을 사용하면 항상 동일한 데이터에 접근합니다. 반면에 상수는 사용될 때마다 데이터를 복제할 수 있습니다. 또 다른 차이점은 정적 변수가 가변적일 수 있다는 것입니다. 가변 정적 변수에 접근하고 수정하는 것은 *unsafe (안전하지 않음)*입니다. Listing 19-10 은 `COUNTER`라는 가변 정적 변수를 선언, 접근 및 수정하는 방법을 보여줍니다.

Filename: `src/main.rs`

```rust
static mut COUNTER: u32 = 0;

fn add_to_count(inc: u32) {
    unsafe {
        COUNTER += inc;
    }
}

fn main() {
    add_to_count(3);

    unsafe {
        println!("COUNTER: {COUNTER}");
    }
}
```

Listing 19-10: 가변 정적 변수를 읽거나 쓰는 것은 unsafe 합니다.

일반 변수와 마찬가지로 `mut` 키워드를 사용하여 가변성을 지정합니다. `COUNTER`에서 읽거나 쓰는 모든 코드는 `unsafe` 블록 내에 있어야 합니다. 이 코드는 단일 스레드이므로 예상대로 컴파일되고 `COUNTER: 3`을 출력합니다. 여러 스레드가 `COUNTER`에 접근하면 데이터 경합이 발생할 수 있습니다.

전역적으로 접근 가능한 가변 데이터의 경우 데이터 경합이 없는지 확인하기 어렵기 때문에 Rust 는 가변 정적 변수를 unsafe 로 간주합니다. 가능한 경우, 컴파일러가 다른 스레드에서 데이터 접근이 안전하게 수행되는지 확인하도록 16 장에서 논의한 동시성 기술과 스레드 안전 스마트 포인터를 사용하는 것이 좋습니다.
