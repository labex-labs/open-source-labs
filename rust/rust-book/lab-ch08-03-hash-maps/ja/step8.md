# 古い値に基づいて値を更新する

ハッシュマップのもう 1 つの一般的な使用例は、キーの値を検索し、古い値に基づいてそれを更新することです。たとえば、リスト 8-25 は、あるテキスト内の各単語が何回出現するかをカウントするコードを示しています。単語をキーとするハッシュマップを使用し、その単語を何回見たかを追跡するために値をインクリメントします。単語を初めて見る場合は、まず値 `0` を挿入します。

```rust
use std::collections::HashMap;

let text = "hello world wonderful world";

let mut map = HashMap::new();

for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count += 1;
}

println!("{:?}", map);
```

リスト 8-25: 単語とカウントを格納するハッシュマップを使用して単語の出現回数をカウントする

このコードは `{"world": 2, "hello": 1, "wonderful": 1}` を出力します。同じキー - 値のペアが異なる順序で出力されることがあります。「ハッシュマップ内の値にアクセスする」で述べたように、ハッシュマップを反復処理するときの順序は任意です。

`split_whitespace` メソッドは、`text` 内の値を空白で区切ったサブスライスのイテレータを返します。`or_insert` メソッドは、指定されたキーの値への可変参照 (`&mut V`) を返します。ここでは、その可変参照を `count` 変数に格納しているので、その値に代入するには、まずアスタリスク (`*`) を使用して `count` を参照外しする必要があります。可変参照は `for` ループの終わりでスコープから外れるため、これらの変更はすべて安全で、借用規則によって許可されています。
