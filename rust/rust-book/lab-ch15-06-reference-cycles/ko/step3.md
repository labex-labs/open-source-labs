# Weak`<T>`를 사용하여 참조 사이클 방지하기{=html}

지금까지 `Rc::clone`을 호출하면 `Rc<T>` 인스턴스의 `strong_count`가 증가하고, `Rc<T>` 인스턴스는 `strong_count`가 0 일 때만 정리된다는 것을 보여드렸습니다. 또한 `Rc::downgrade`를 호출하고 `Rc<T>`에 대한 참조를 전달하여 `Rc<T>` 인스턴스 내의 값에 대한 _약한 참조_ (weak reference) 를 생성할 수 있습니다. 강한 참조는 `Rc<T>` 인스턴스의 소유권을 공유하는 방법입니다. 약한 참조는 소유권 관계를 표현하지 않으며, 해당 횟수는 `Rc<T>` 인스턴스가 정리되는 시점에 영향을 미치지 않습니다. 약한 참조가 포함된 사이클은 관련 값의 강한 참조 횟수가 0 이 되면 깨지므로 참조 사이클을 유발하지 않습니다.

`Rc::downgrade`를 호출하면 `Weak<T>` 유형의 스마트 포인터를 얻게 됩니다. `Rc::downgrade`를 호출하면 `Rc<T>` 인스턴스의 `strong_count`를 1 증가시키는 대신 `weak_count`가 1 증가합니다. `Rc<T>` 타입은 `strong_count`와 유사하게 `weak_count`를 사용하여 `Weak<T>` 참조가 얼마나 존재하는지 추적합니다. 차이점은 `Rc<T>` 인스턴스가 정리되기 위해 `weak_count`가 0 일 필요가 없다는 것입니다.

`Weak<T>`가 참조하는 값은 drop 되었을 수 있으므로, `Weak<T>`가 가리키는 값으로 무언가를 하려면 해당 값이 여전히 존재하는지 확인해야 합니다. `Weak<T>` 인스턴스에서 `upgrade` 메서드를 호출하여 이 작업을 수행합니다. 그러면 `Option<Rc<T>>`가 반환됩니다. `Rc<T>` 값이 아직 drop 되지 않은 경우 `Some` 결과를 얻고, `Rc<T>` 값이 drop 된 경우 `None` 결과를 얻습니다. `upgrade`는 `Option<Rc<T>>`를 반환하므로 Rust 는 `Some` 케이스와 `None` 케이스가 처리되도록 보장하며, 유효하지 않은 포인터가 존재하지 않습니다.

예를 들어, 다음 항목에 대해서만 아는 리스트를 사용하는 대신, 자식 항목 _및_ 부모 항목에 대해 아는 트리를 생성합니다.
