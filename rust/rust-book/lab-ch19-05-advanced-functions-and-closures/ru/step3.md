# Возвращение замыканий

Замыкания представляются трейтами, что означает, что вы не можете напрямую возвращать замыкания. В большинстве случаев, когда вы хотите вернуть трейт, вы можете вместо этого использовать конкретный тип, который реализует трейт, в качестве возвращаемого значения функции. Однако вы не можете сделать этого с замыканиями, потому что у них нет конкретного типа, который можно вернуть; например, вы не можете использовать указатель на функцию `fn` в качестве возвращаемого типа.

Следующий код пытается напрямую вернуть замыкание, но он не скомпилируется:

```rust
fn returns_closure() -> dyn Fn(i32) -> i32 {
    |x| x + 1
}
```

Ошибка компилятора выглядит так:

```bash
error[E0746]: return type cannot have an unboxed trait object
 --> src/lib.rs:1:25
  |
1 | fn returns_closure() -> dyn Fn(i32) -> i32 {
  |                         ^^^^^^^^^^^^^^^^^^ doesn't have a size known at
compile-time
  |
  = note: for information on `impl Trait`, see
<https://doc.rust-lang.org/book/ch10-02-traits.html#returning-types-that-
implement-traits>
help: use `impl Fn(i32) -> i32` as the return type, as all return paths are of
type `[closure@src/lib.rs:2:5: 2:14]`, which implements `Fn(i32) -> i32`
  |
1 | fn returns_closure() -> impl Fn(i32) -> i32 {
  |                         ~~~~~~~~~~~~~~~~~~~
```

Ошибка снова ссылается на трейт `Sized`! Rust не знает, сколько места ему потребуется для хранения замыкания. Мы видели решение этой проблемы ранее. Мы можем использовать объект трейта:

```rust
fn returns_closure() -> Box<dyn Fn(i32) -> i32> {
    Box::new(|x| x + 1)
}
```

Этот код скомпилируется без ошибок. Для получения дополнительной информации о объектах трейтов, обратитесь к разделу "Использование объектов трейтов, которые допускают значения разных типов".

Далее давайте посмотрим на макросы!
