# `pub use`를 사용하여 편리한 공개 API 내보내기

크레이트를 게시할 때 공개 API 의 구조는 중요한 고려 사항입니다. 크레이트를 사용하는 사람들은 당신보다 구조에 익숙하지 않으며, 크레이트에 큰 모듈 계층 구조가 있는 경우 사용하려는 부분을 찾는 데 어려움을 겪을 수 있습니다.

7 장에서 `pub` 키워드를 사용하여 항목을 공개하는 방법과 `use` 키워드를 사용하여 항목을 범위로 가져오는 방법을 다루었습니다. 그러나 크레이트를 개발하는 동안 당신에게 적합한 구조가 사용자에게는 그다지 편리하지 않을 수 있습니다. 여러 수준을 포함하는 계층 구조로 구조체를 구성할 수 있지만, 계층 구조 깊숙한 곳에서 정의한 타입을 사용하려는 사람은 해당 타입이 존재한다는 것을 찾는 데 어려움을 겪을 수 있습니다. 또한 `use` `my_crate::`some_module`::`another_module`::`UsefulType`;` 대신 `use` `my_crate::`UsefulType`;`를 입력해야 하는 것에 짜증을 낼 수도 있습니다.

좋은 소식은 다른 라이브러리에서 사용하기에 구조가 편리하지 않은 경우 내부 구성을 재정렬할 필요가 없다는 것입니다. 대신 `pub use`를 사용하여 항목을 다시 내보내어 개인 구조와 다른 공개 구조를 만들 수 있습니다. *재내보내기*는 한 위치의 공개 항목을 다른 위치에서 공개적으로 만들며, 마치 다른 위치에서 정의된 것처럼 작동합니다.

예를 들어, 예술적 개념을 모델링하기 위한 `art`라는 라이브러리를 만들었다고 가정해 보겠습니다. 이 라이브러리 내에는 `PrimaryColor` 및 `SecondaryColor`라는 두 개의 열거형을 포함하는 `kinds` 모듈과 `mix`라는 함수를 포함하는 `utils` 모듈이 있습니다 (목록 14-3 참조).

파일 이름: `src/lib.rs`

```rust
//! # Art
//!
//! 예술적 개념을 모델링하기 위한 라이브러리입니다.

pub mod kinds {
    /// RYB 색상 모델에 따른 기본 색상입니다.
    pub enum PrimaryColor {
        Red,
        Yellow,
        Blue,
    }

    /// RYB 색상 모델에 따른 보조 색상입니다.
    pub enum SecondaryColor {
        Orange,
        Green,
        Purple,
    }
}

pub mod utils {
    use crate::kinds::*;

    /// 두 개의 기본 색상을 동일한 양으로 결합하여
    /// 보조 색상을 만듭니다.
    pub fn mix(
        c1: PrimaryColor,
        c2: PrimaryColor,
    ) -> SecondaryColor {
        --snip--
    }
}
```

목록 14-3: `kinds` 및 `utils` 모듈로 구성된 `art` 라이브러리

그림 14-3 은 `cargo doc`에서 생성된 이 크레이트에 대한 문서의 첫 페이지가 어떻게 표시되는지 보여줍니다.

그림 14-3: `kinds` 및 `utils` 모듈을 나열하는 `art`에 대한 문서의 첫 페이지

`PrimaryColor` 및 `SecondaryColor` 타입은 첫 페이지에 나열되지 않으며, `mix` 함수도 마찬가지입니다. `kinds` 및 `utils`를 클릭해야 볼 수 있습니다.

이 라이브러리에 의존하는 다른 크레이트는 `art`에서 항목을 범위로 가져오는 `use` 문이 필요하며, 현재 정의된 모듈 구조를 지정합니다. 목록 14-4 는 `art` 크레이트에서 `PrimaryColor` 및 `mix` 항목을 사용하는 크레이트의 예제를 보여줍니다.

파일 이름: `src/main.rs`

```rust
use art::kinds::PrimaryColor;
use art::utils::mix;

fn main() {
    let red = PrimaryColor::Red;
    let yellow = PrimaryColor::Yellow;
    mix(red, yellow);
}
```

목록 14-4: 내부 구조가 내보내진 `art` 크레이트의 항목을 사용하는 크레이트

`art` 크레이트를 사용하는 목록 14-4 의 코드 작성자는 `PrimaryColor`가 `kinds` 모듈에 있고 `mix`가 `utils` 모듈에 있다는 것을 알아내야 했습니다. `art` 크레이트의 모듈 구조는 이를 사용하는 사람보다 `art` 크레이트에서 작업하는 개발자에게 더 관련이 있습니다. 내부 구조는 `art` 크레이트를 사용하는 방법을 이해하려는 사람에게 유용한 정보를 포함하지 않지만, 사용자가 어디를 찾아야 하는지 알아내야 하고 `use` 문에서 모듈 이름을 지정해야 하므로 혼란을 야기합니다.

공개 API 에서 내부 구성을 제거하기 위해 목록 14-3 의 `art` 크레이트 코드를 수정하여 목록 14-5 에 표시된 것처럼 최상위 수준에서 항목을 다시 내보내기 위해 `pub use` 문을 추가할 수 있습니다.

파일 이름: `src/lib.rs`

```rust
//! # Art
//!
//! 예술적 개념을 모델링하기 위한 라이브러리입니다.

pub use self::kinds::PrimaryColor;
pub use self::kinds::SecondaryColor;
pub use self::utils::mix;

pub mod kinds {
    --snip--
}

pub mod utils {
    --snip--
}
```

목록 14-5: 항목을 다시 내보내기 위해 `pub use` 문 추가

`cargo doc`가 이 크레이트에 대해 생성하는 API 문서는 이제 그림 14-4 에 표시된 것처럼 첫 페이지에 다시 내보내기를 나열하고 연결하여 `PrimaryColor` 및 `SecondaryColor` 타입과 `mix` 함수를 더 쉽게 찾을 수 있도록 합니다.

그림 14-4: 다시 내보내기를 나열하는 `art`에 대한 문서의 첫 페이지

`art` 크레이트 사용자는 목록 14-4 에 표시된 것처럼 목록 14-3 의 내부 구조를 계속 보고 사용할 수 있으며, 목록 14-6 에 표시된 것처럼 목록 14-5 의 더 편리한 구조를 사용할 수도 있습니다.

파일 이름: `src/main.rs`

```rust
use art::mix;
use art::PrimaryColor;

fn main() {
    --snip--
}
```

목록 14-6: `art` 크레이트에서 다시 내보낸 항목을 사용하는 프로그램

많은 중첩된 모듈이 있는 경우 `pub use`를 사용하여 최상위 수준에서 타입을 다시 내보내는 것은 크레이트를 사용하는 사람들의 경험에 상당한 차이를 만들 수 있습니다. `pub use`의 또 다른 일반적인 사용 사례는 현재 크레이트에서 종속성의 정의를 다시 내보내어 해당 크레이트의 정의를 크레이트의 공개 API 의 일부로 만드는 것입니다.

유용한 공개 API 구조를 만드는 것은 과학보다는 예술에 가깝고, 사용자를 위해 가장 잘 작동하는 API 를 찾기 위해 반복할 수 있습니다. `pub use`를 선택하면 크레이트를 내부적으로 구조화하는 방식에 유연성을 제공하고 내부 구조를 사용자에게 제공하는 것과 분리할 수 있습니다. 설치한 크레이트의 일부 코드를 살펴보고 내부 구조가 공개 API 와 다른지 확인하십시오.
