# Was ist Besitz?

_Besitz_ ist eine Reihe von Regeln, die bestimmen, wie ein Rust-Programm den Arbeitsspeicher verwaltet. Alle Programme müssen die Art und Weise steuern, wie sie den Arbeitsspeicher eines Computers während der Ausführung verwenden. Einige Sprachen haben einen Garbage Collector, der während der Ausführung regelmäßig nach nicht mehr verwendeten Arbeitsspeicher sucht; in anderen Sprachen muss der Programmierer den Arbeitsspeicher explizit zuweisen und freigeben. Rust verwendet einen dritten Ansatz: Der Arbeitsspeicher wird durch ein System des Besitzes mit einer Reihe von Regeln verwaltet, die der Compiler überprüft. Wenn eine der Regeln verletzt wird, kompiliert das Programm nicht. Keine der Eigenschaften des Besitzes verlangsamt dein Programm während der Ausführung.

Da der Besitz für viele Programmierer ein neues Konzept ist, dauert es einige Zeit, sich daran zu gewöhnen. Die gute Nachricht ist, dass du mit zunehmender Erfahrung mit Rust und den Regeln des Besitzsystems findest, dass es einfacher wird, Code zu entwickeln, der sicher und effizient ist. Halte durch!

Wenn du den Besitz verstehst, wirst du eine solide Grundlage für das Verständnis der Eigenschaften haben, die Rust einzigartig machen. In diesem Kapitel wirst du den Besitz durch einige Beispiele lernen, die sich auf eine sehr häufige Datenstruktur konzentrieren: Strings.

> **Der Stapel und der Heap**
>
> Viele Programmiersprachen erfordern es dich nicht, dich oft mit dem Stapel und dem Heap zu befassen. Aber in einer Systems-Programmiersprache wie Rust hat es Auswirkungen auf das Verhalten der Sprache und warum du bestimmte Entscheidungen treffen musst, ob ein Wert auf dem Stapel oder auf dem Heap liegt. Teile des Besitzes werden später in diesem Kapitel im Zusammenhang mit dem Stapel und dem Heap beschrieben, hier ist daher eine kurze Erklärung als Vorbereitung.
>
> Sowohl der Stapel als auch der Heap sind Teile des Arbeitsspeichers, der deinem Code zur Laufzeit zur Verfügung steht, aber sie sind unterschiedlich strukturiert. Der Stapel speichert Werte in der Reihenfolge, in der er sie erhält, und entfernt die Werte in umgekehrter Reihenfolge. Dies wird als _letzt dran, zuerst raus_ bezeichnet. Denke an einen Stapel mit Tellern: Wenn du mehr Teller hinzufügst, legst du sie auf den Stapel, und wenn du einen Teller brauchst, nimmst du einen von oben. Ein Teller aus der Mitte oder unten hinzufügen oder entfernen würde nicht so gut funktionieren! Das Hinzufügen von Daten wird als _Auf den Stapel legen_ bezeichnet, und das Entfernen von Daten wird als _Von dem Stapel nehmen_ bezeichnet. Alle auf dem Stapel gespeicherten Daten müssen eine bekannte, feste Größe haben. Daten mit einer unbekannten Größe zur Compile-Zeit oder einer Größe, die sich ändern kann, müssen stattdessen auf dem Heap gespeichert werden.
>
> Der Heap ist weniger strukturiert: Wenn du Daten auf den Heap legst, beantragst du einen bestimmten Speicherplatz. Der Arbeitsspeicherzuweisungsdienst sucht einen leeren Platz im Heap, der groß genug ist, markiert ihn als in Gebrauch und gibt einen _Zeiger_ zurück, der die Adresse dieses Ortes ist. Dieser Prozess wird als _Auf dem Heap zuweisen_ bezeichnet und wird manchmal abgekürzt als einfach _zuweisen_ (das Auf den Stapel legen von Werten wird nicht als zuweisen betrachtet). Da der Zeiger auf den Heap eine bekannte, feste Größe hat, kannst du den Zeiger auf dem Stapel speichern, aber wenn du das tatsächliche Daten benötigst, musst du den Zeiger folgen. Denke daran, in einem Restaurant Platz zu nehmen. Wenn du eintreibst, gibst du die Anzahl der Personen in deiner Gruppe an, und der Wirt findet einen leeren Tisch, der für alle passt, und führt dich dahin. Wenn jemand in deiner Gruppe später kommt, kann er fragen, wo ihr gesessen seid, um euch zu finden.
>
> Das Auf den Stapel legen ist schneller als das Zuweisen auf dem Heap, weil der Arbeitsspeicherzuweisungsdienst nie suchen muss, einen Platz zum Speichern neuer Daten zu finden; dieser Ort ist immer oben auf dem Stapel. Im Vergleich dazu erfordert das Zuweisen von Speicherplatz auf dem Heap mehr Arbeit, weil der Arbeitsspeicherzuweisungsdienst zunächst einen groß genug Platz finden muss, um die Daten aufzunehmen, und dann Buchhaltung betreiben muss, um sich auf die nächste Zuweisung vorzubereiten.
>
> Das Zugreifen auf Daten im Heap ist langsamer als das Zugreifen auf Daten auf dem Stapel, weil du einen Zeiger folgen musst, um dorthin zu gelangen. Moderne Prozessoren arbeiten schneller, wenn sie weniger im Arbeitsspeicher springen. Fortführend mit der Analogie, stell dir einen Kellner in einem Restaurant vor, der Bestellungen von vielen Tischen entgegennimmt. Es ist am effizientesten, alle Bestellungen von einem Tisch zu erhalten, bevor man zum nächsten Tisch geht. Eine Bestellung von Tisch A, dann eine von Tisch B, dann wieder eine von A und dann wieder eine von B wäre ein viel langsamerer Prozess. Aus dem gleichen Grund kann ein Prozessor seine Arbeit besser erledigen, wenn er an Daten arbeitet, die in der Nähe anderer Daten liegen (wie auf dem Stapel), als wenn sie weiter weg liegen (wie auf dem Heap).
>
> Wenn dein Code eine Funktion aufruft, werden die an die Funktion übergebenen Werte (einschließlich möglicherweise Zeiger auf Daten auf dem Heap) und die lokalen Variablen der Funktion auf den Stapel gelegt. Wenn die Funktion beendet ist, werden diese Werte vom Stapel genommen.
>
> Die Aufzeichnung davon, welche Teile des Codes welche Daten auf dem Heap verwenden, die Minimierung der Anzahl von Duplikaten auf dem Heap und das Bereinigen von nicht mehr verwendeten Daten auf dem Heap, damit du nicht aus Platz kommst, sind alle Probleme, die der Besitz löst. Wenn du den Besitz verstehst, musst du dich nicht oft mit dem Stapel und dem Heap befassen, aber das Wissen, dass der Hauptzweck des Besitzes darin besteht, Heap-Daten zu verwalten, kann helfen, zu erklären, warum er so funktioniert.
