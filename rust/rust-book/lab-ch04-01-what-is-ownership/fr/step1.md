# Qu'est-ce que la propriété?

La **propriété** est un ensemble de règles qui régissent la manière dont un programme Rust gère la mémoire. Tous les programmes doivent gérer la manière dont ils utilisent la mémoire d'un ordinateur pendant leur exécution. Certaines langues ont une collecte de détritus qui recherche régulièrement la mémoire plus utilisée pendant l'exécution du programme; dans d'autres langues, le programmeur doit explicitement allouer et libérer la mémoire. Rust utilise une troisième approche: la mémoire est gérée à travers un système de propriété avec un ensemble de règles que le compilateur vérifie. Si l'une des règles est violée, le programme ne se compilera pas. Aucune des fonctionnalités de la propriété ne ralentira votre programme pendant son exécution.

Parce que la propriété est un nouveau concept pour de nombreux programmeurs, il faut effectivement un certain temps pour s'y habituer. La bonne nouvelle est que plus vous serez expérimenté avec Rust et les règles du système de propriété, plus il vous sera facile de développer naturellement du code sûr et efficace. Continuez!

Lorsque vous comprenez la propriété, vous aurez les bases solides pour comprendre les fonctionnalités qui rendent Rust unique. Dans ce chapitre, vous allez découvrir la propriété en travaillant sur quelques exemples qui se concentrent sur une structure de données très courante: les chaînes de caractères.

> **La pile et le tas**
>
> Plusieurs langages de programmation ne vous obligent pas à vous préoccuper souvent de la pile et du tas. Mais dans un langage de programmation système comme Rust, le fait qu'une valeur se trouve sur la pile ou sur le tas affecte le comportement du langage et pourquoi vous devez prendre certaines décisions. Certaines parties de la propriété seront décrites en relation avec la pile et le tas plus loin dans ce chapitre, donc voici une brève explication à titre préparatoire.
>
> La pile et le tas sont tous deux des parties de la mémoire disponibles pour votre code à l'exécution, mais ils sont structurés différemment. La pile stocke les valeurs dans l'ordre dans lequel elle les reçoit et supprime les valeurs dans l'ordre inverse. C'est ce qu'on appelle _dernier entré, premier sorti_. Imaginez une pile de assiettes: lorsque vous ajoutez de nouvelles assiettes, vous les mettez au sommet de la pile, et lorsque vous avez besoin d'une assiette, vous en retirez une du sommet. Ajouter ou retirer des assiettes du milieu ou du bas ne fonctionnerait pas aussi bien! Ajouter des données s'appelle _empiler sur la pile_, et retirer des données s'appelle _dépiler de la pile_. Toutes les données stockées sur la pile doivent avoir une taille connue et fixe. Les données dont la taille est inconnue au moment de la compilation ou qui peuvent changer doivent être stockées sur le tas à la place.
>
> Le tas est moins organisé: lorsque vous mettez des données sur le tas, vous demandez une certaine quantité d'espace. L'allocateur de mémoire trouve un emplacement vide dans le tas assez grand, le marque comme étant utilisé et renvoie un _pointeur_, qui est l'adresse de cet emplacement. Ce processus s'appelle _allouer sur le tas_ et est parfois abrégé en _allouer_ seulement (empiler des valeurs sur la pile n'est pas considéré comme allouer). Parce que le pointeur vers le tas est une taille connue et fixe, vous pouvez stocker le pointeur sur la pile, mais lorsque vous voulez les données réelles, vous devez suivre le pointeur. Imaginez que vous êtes assis dans un restaurant. Lorsque vous entrez, vous indiquez le nombre de personnes dans votre groupe, et l'hôte trouve une table vide qui peut accueillir tout le monde et vous y conduit. Si quelqu'un de votre groupe arrive en retard, il peut demander où vous êtes assis pour vous trouver.
>
> Empiler sur la pile est plus rapide que d'allouer sur le tas parce que l'allocateur n'a jamais besoin de chercher un emplacement pour stocker de nouvelles données; cet emplacement est toujours au sommet de la pile. Comparativement, allouer de l'espace sur le tas nécessite plus de travail parce que l'allocateur doit d'abord trouver un espace suffisamment grand pour stocker les données et puis effectuer des mises à jour pour préparer la prochaine allocation.
>
> Accéder aux données dans le tas est plus lent que d'accéder aux données sur la pile parce que vous devez suivre un pointeur pour y arriver. Les processeurs modernes sont plus rapides s'ils sautent moins dans la mémoire. En continuant l'analogie, imaginez un serveur dans un restaurant prenant les commandes de plusieurs tables. Il est le plus efficace de prendre toutes les commandes d'une table avant de passer à la suivante. Prendre une commande de la table A, puis une commande de la table B, puis une autre de la table A, puis une autre de la table B serait un processus beaucoup plus lent. Dans le même sens, un processeur peut mieux faire son travail s'il travaille sur des données proches d'autres données (comme c'est le cas sur la pile) plutôt que plus loin (comme cela peut être le cas sur le tas).
>
> Lorsque votre code appelle une fonction, les valeurs passées à la fonction (y compris, potentiellement, des pointeurs vers des données sur le tas) et les variables locales de la fonction sont empilées sur la pile. Lorsque la fonction est terminée, ces valeurs sont dépilées de la pile.
>
> Suivre les parties du code qui utilisent quelles données sur le tas, minimiser la quantité de données dupliquées sur le tas et nettoyer les données inutilisées sur le tas pour ne pas épuiser l'espace sont tous des problèmes que la propriété résout. Une fois que vous comprenez la propriété, vous n'aurez pas besoin de vous préoccuper souvent de la pile et du tas, mais savoir que le principal but de la propriété est de gérer les données du tas peut aider à expliquer pourquoi elle fonctionne comme elle le fait.
