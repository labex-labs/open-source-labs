# Определение Post и создание нового экземпляра в состоянии черновика

Давайте приступим к реализации библиотеки! Мы знаем, что нам нужна общедоступная структура `Post`, которая будет хранить некоторое содержание, поэтому мы начнем с определения структуры и связанной с ней общедоступной функции `new`, чтобы создать экземпляр `Post`, как показано в Листинге 17-12. Мы также создадим приватный трейт `State`, который определит поведение, которое должны иметь все объекты состояния для `Post`.

Затем `Post` будет хранить объект трейта `Box<dyn State>` внутри `Option<T>` в приватном поле с именем `state`, чтобы хранить объект состояния. Через некоторое время вы поймете, почему необходимо `Option<T>`.

Имя файла: `src/lib.rs`

```rust
pub struct Post {
    state: Option<Box<dyn State>>,
    content: String,
}

impl Post {
    pub fn new() -> Post {
        Post {
          1 state: Some(Box::new(Draft {})),
          2 content: String::new(),
        }
    }
}

trait State {}

struct Draft {}

impl State for Draft {}
```

Листинг 17-12: Определение структуры `Post` и функции `new`, которая создает новый экземпляр `Post`, трейта `State` и структуры `Draft`

Трейт `State` определяет поведение, общие для различных состояний записи. Объекты состояния - это `Draft`, `PendingReview` и `Published`, и все они будут реализовывать трейт `State`. На данный момент трейт не имеет никаких методов, и мы начнем с определения только состояния `Draft`, потому что именно в этом состоянии должна начинаться запись.

Когда мы создаем новый экземпляр `Post`, мы устанавливаем его поле `state` в значение `Some`, которое содержит `Box` \[1\]. Этот `Box` ссылается на новый экземпляр структуры `Draft`. Это гарантирует, что каждый раз, когда мы создаем новый экземпляр `Post`, он будет начинаться как черновик. Поскольку поле `state` структуры `Post` приватно, невозможно создать `Post` в каком-либо другом состоянии! В функции `Post::new` мы устанавливаем поле `content` в новую, пустую `String` \[2\].
