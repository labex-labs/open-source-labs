# 객체 지향 디자인 패턴 구현

*상태 패턴 (state pattern)*은 객체 지향 디자인 패턴입니다. 이 패턴의 핵심은 값이 내부적으로 가질 수 있는 일련의 상태를 정의하는 것입니다. 상태는 일련의 *상태 객체 (state objects)*로 표현되며, 값의 동작은 해당 상태에 따라 변경됩니다. 우리는 상태를 저장하는 필드를 가진 블로그 게시물 구조체의 예제를 살펴볼 것입니다. 이 필드는 "초안 (draft)", "검토 (review)", 또는 "게시됨 (published)" 중 하나의 상태 객체가 될 것입니다.

상태 객체는 기능을 공유합니다. 물론 Rust 에서는 객체와 상속 대신 구조체 (structs) 와 트레이트 (traits) 를 사용합니다. 각 상태 객체는 자체 동작을 담당하고 다른 상태로 변경되어야 하는 시기를 관리합니다. 상태 객체를 보유하는 값은 상태의 다른 동작이나 상태 간의 전환 시기에 대해 아무것도 알지 못합니다.

상태 패턴을 사용하는 장점은 프로그램의 비즈니스 요구 사항이 변경될 때 상태를 보유하는 값의 코드나 해당 값을 사용하는 코드를 변경할 필요가 없다는 것입니다. 규칙을 변경하거나 더 많은 상태 객체를 추가하려면 상태 객체 중 하나의 내부 코드만 업데이트하면 됩니다.

먼저, 더 전통적인 객체 지향 방식으로 상태 패턴을 구현한 다음, Rust 에서 좀 더 자연스러운 접근 방식을 사용할 것입니다. 상태 패턴을 사용하여 블로그 게시물 워크플로우를 점진적으로 구현해 보겠습니다.

최종 기능은 다음과 같습니다.

1.  블로그 게시물은 빈 초안으로 시작합니다.
2.  초안이 완료되면 게시물 검토가 요청됩니다.
3.  게시물이 승인되면 게시됩니다.
4.  게시된 블로그 게시물만 인쇄할 콘텐츠를 반환하므로 승인되지 않은 게시물은 실수로 게시될 수 없습니다.

게시물에 대한 다른 변경 시도는 아무런 효과가 없어야 합니다. 예를 들어, 검토를 요청하기 전에 초안 블로그 게시물을 승인하려고 하면 게시물은 게시되지 않은 초안 상태로 유지되어야 합니다.

Listing 17-11 은 이 워크플로우를 코드 형태로 보여줍니다. 이것은 `blog`라는 라이브러리 크레이트 (crate) 에서 구현할 API 의 사용 예입니다. `blog` 크레이트를 구현하지 않았으므로 아직 컴파일되지 않습니다.

파일 이름: `src/main.rs`

```rust
use blog::Post;

fn main() {
  1 let mut post = Post::new();

  2 post.add_text("I ate a salad for lunch today");
  3 assert_eq!("", post.content());

  4 post.request_review();
  5 assert_eq!("", post.content());

  6 post.approve();
  7 assert_eq!("I ate a salad for lunch today", post.content());
}
```

Listing 17-11: `blog` 크레이트가 가져야 할 원하는 동작을 보여주는 코드

사용자가 `Post::new` \[1]을 사용하여 새 초안 블로그 게시물을 만들 수 있도록 하려고 합니다. 텍스트를 블로그 게시물에 추가할 수 있도록 하려고 합니다 \[2]. 승인 전에 게시물의 콘텐츠를 즉시 가져오려고 하면 게시물이 아직 초안 상태이므로 텍스트가 반환되지 않아야 합니다. 데모 목적으로 코드에 `assert_eq!`를 추가했습니다 \[3]. 이에 대한 훌륭한 단위 테스트는 초안 블로그 게시물이 `content` 메서드에서 빈 문자열을 반환하는지 확인하는 것이지만, 이 예제에 대한 테스트는 작성하지 않겠습니다.

다음으로, 게시물 검토 요청을 활성화하고 \[4], 검토를 기다리는 동안 `content`가 빈 문자열을 반환하도록 하려고 합니다 \[5]. 게시물이 승인을 받으면 \[6], 게시되어야 합니다. 즉, `content`가 호출될 때 게시물의 텍스트가 반환됩니다 \[7].

크레이트에서 상호 작용하는 유일한 유형은 `Post` 유형입니다. 이 유형은 상태 패턴을 사용하고 게시물이 가질 수 있는 다양한 상태 (초안, 검토 또는 게시됨) 를 나타내는 세 가지 상태 객체 중 하나가 될 값을 보유합니다. 한 상태에서 다른 상태로의 변경은 `Post` 유형 내에서 내부적으로 관리됩니다. 상태는 라이브러리 사용자가 `Post` 인스턴스에서 호출하는 메서드에 대한 응답으로 변경되지만 상태 변경을 직접 관리할 필요는 없습니다. 또한 사용자는 게시물을 검토 전에 게시하는 등 상태에 실수를 할 수 없습니다.
