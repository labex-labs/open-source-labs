# Зависимость от внешнего пакета в рабочем пространстве

Заметим, что рабочее пространство имеет только один файл _Cargo.lock_ на верхнем уровне, а не отдельный _Cargo.lock_ в каждой директории ящика. Это гарантирует, что все ящики используют одну и ту же версию всех зависимостей. Если мы добавим пакет `rand` в файлы _adder/Cargo.toml_ и _add_one/Cargo.toml_, Cargo будет разрешать обе эти зависимости на одну версию `rand` и записывать это в единственный _Cargo.lock_. Тому, что все ящики в рабочем пространстве используют одинаковые зависимости, означает, что ящики всегда будут совместимы друг с другом. Добавим пакет `rand` в раздел `[dependencies]` в файле _add_one/Cargo.toml_, чтобы мы могли использовать пакет `rand` в ящике `add_one`:

Имя файла: `add_one/Cargo.toml`

```tomlrust
[dependencies]
rand = "0.8.5"
```

Теперь мы можем добавить `use rand;` в файл `add_one/src/lib.rs`, и сборка всего рабочего пространства с помощью `cargo build` в директории `add` будет включать и компилировать пакет `rand`. Мы получим одно предупреждение, потому что мы не обращаемся к `rand`, который мы добавили в область видимости:

```bash
$ cargo build
    Updating crates.io index
  Downloaded rand v0.8.5
   --snip--
   Compiling rand v0.8.5
   Compiling add_one v0.1.0 (file:///projects/add/add_one)
   Compiling adder v0.1.0 (file:///projects/add/adder)
    Finished dev [unoptimized + debuginfo] target(s) in 10.18s
```

Теперь верхнеуровневый _Cargo.lock_ содержит информацию о зависимости `add_one` от `rand`. Однако, даже если `rand` используется где-то в рабочем пространстве, мы не можем использовать его в других ящиках в рабочем пространстве, если не добавим `rand` в их файлы `Cargo.toml` также. Например, если мы добавим `use rand;` в файл `adder/src/main.rs` для пакета `adder`, мы получим ошибку:

```bash
$ cargo build
   --snip--
   Compiling adder v0.1.0 (file:///projects/add/adder)
error[E0432]: unresolved import `rand`
 --> adder/src/main.rs:2:5
  |
2 | use rand;
  |     ^^^^ no external crate `rand`
```

Чтобы исправить это, отредактируйте файл `Cargo.toml` для пакета `adder` и укажите, что `rand` также является зависимостью для него. Сборка пакета `adder` добавит `rand` в список зависимостей для `adder` в _Cargo.lock_, но дополнительные копии `rand` не будут загружены. Cargo гарантирует, что каждый ящик в каждом пакете в рабочем пространстве, использующем пакет `rand`, будет использовать одну и ту же версию, экономя таким образом место и обеспечивая совместимость ящиков в рабочем пространстве.
