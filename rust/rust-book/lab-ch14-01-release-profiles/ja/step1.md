# リリースプロファイルを使ったビルドのカスタマイズ

Rustにおいて、「リリースプロファイル」は、異なる設定を持つ事前定義済みでカスタマイズ可能なプロファイルであり、プログラマーがコードをコンパイルするためのさまざまなオプションに対してより多くの制御を行えるようにします。各プロファイルは独立して設定されます。

Cargoには2つの主なプロファイルがあります。1つは、`cargo build`を実行する際にCargoが使用する`dev`プロファイルであり、もう1つは、`cargo build --release`を実行する際にCargoが使用する`release`プロファイルです。`dev`プロファイルは、開発用に良好なデフォルト設定で定義されており、`release`プロファイルは、リリースビルド用に良好なデフォルト設定を持っています。

これらのプロファイル名は、ビルドの出力からおなじみかもしれません。

```bash
$ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.0s
$ cargo build --release
    Finished release [optimized] target(s) in 0.0s
```

`dev`と`release`は、コンパイラが使用するこれらの異なるプロファイルです。

プロジェクトの`Cargo.toml`ファイルに明示的に`[profile.*]`セクションを追加していない場合、Cargoは各プロファイルに対してデフォルト設定を適用します。カスタマイズしたい任意のプロファイルに対して`[profile.*]`セクションを追加することで、デフォルト設定の任意のサブセットを上書きすることができます。たとえば、`dev`プロファイルと`release`プロファイルの`opt-level`設定のデフォルト値は次のとおりです。

ファイル名: `Cargo.toml`

```tomltoml
[profile.dev]
opt-level = 0

[profile.release]
opt-level = 3
```

`opt-level`設定は、Rustがコードに適用する最適化の数を制御し、0から3の範囲です。最適化を多く適用するとコンパイル時間が延びるため、開発中に頻繁にコードをコンパイルする場合、結果として得られるコードが動作が遅くなっても、コンパイル速度を上げるために最適化を少なくすることが望ましいでしょう。したがって、`dev`のデフォルトの`opt-level`は`0`です。コードをリリースする準備ができたら、コンパイルに時間をかける方が良いでしょう。リリースモードでは一度だけコンパイルしますが、コンパイルされたプログラムを何度も実行するため、リリースモードでは、コンパイル時間を長くする代わりに、動作が速いコードを得ます。これが、`release`プロファイルのデフォルトの`opt-level`が`3`である理由です。

`Cargo.toml`で異なる値を追加することで、デフォルト設定を上書きすることができます。たとえば、開発プロファイルで最適化レベル1を使用したい場合、プロジェクトの`Cargo.toml`ファイルに次の2行を追加することができます。

ファイル名: `Cargo.toml`

```tomltoml
[profile.dev]
opt-level = 1
```

このコードは、デフォルト設定の`0`を上書きします。これで、`cargo build`を実行すると、Cargoは`dev`プロファイルのデフォルト設定に加えて、`opt-level`へのカスタマイズを使用します。`opt-level`を`1`に設定したため、Cargoはデフォルトよりも多くの最適化を適用しますが、リリースビルドほど多くはありません。

各プロファイルの構成オプションとデフォルトの完全な一覧については、*https://doc.rust-lang.org/cargo/reference/profiles.html*のCargoのドキュメントを参照してください。
