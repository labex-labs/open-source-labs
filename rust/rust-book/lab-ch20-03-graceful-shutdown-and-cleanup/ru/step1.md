# Graceful Shutdown and Cleanup

Код в Листинге 20-20 асинхронно обрабатывает запросы с использованием пула потоков, как мы планировали. Мы получаем несколько предупреждений о полях `workers`, `id` и `thread`, которые мы не используем напрямую, что напоминает нам, что мы ничего не очищаем. Когда мы используем менее элегантный метод ctrl-C для остановки главного потока, все остальные потоки также немедленно останавливаются, даже если они находятся в середине обработки запроса.

Далее мы реализуем трейт `Drop`, чтобы вызвать метод `join` для каждого потока в пуле, чтобы они могли завершить обработку запросов, которые они обрабатывают, перед закрытием. Затем мы реализуем способ сообщить потокам, что они должны прекратить принимать новые запросы и выключиться. Чтобы увидеть этот код в действии, мы модифицируем наш сервер, чтобы он принимал только два запроса, прежде чем优雅но выключить свой пул потоков.
