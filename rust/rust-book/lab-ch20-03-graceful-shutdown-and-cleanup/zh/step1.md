# 优雅关闭与清理

如我们所愿，清单 20-20 中的代码通过使用线程池异步响应请求。我们收到了一些关于`workers`、`id`和`thread`字段的警告，这些字段我们没有直接使用，这提醒我们没有清理任何东西。当我们使用不太优雅的 ctrl-C 方法来停止主线程时，所有其他线程也会立即停止，即使它们正在处理请求的过程中。

接下来，我们将实现`Drop`特性，以便对线程池中的每个线程调用`join`，这样它们就可以在关闭之前完成正在处理的请求。然后，我们将实现一种方法来告诉线程它们应该停止接受新请求并关闭。为了看到这段代码的实际运行情况，我们将修改我们的服务器，使其在优雅地关闭线程池之前只接受两个请求。
