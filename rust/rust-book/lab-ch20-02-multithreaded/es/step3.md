# Mejora de la rendimiento con un grupo de subprocesos

Un _grupo de subprocesos_ es un grupo de subprocesos creados que están esperando y listos para manejar una tarea. Cuando el programa recibe una nueva tarea, asigna uno de los subprocesos del grupo a la tarea, y ese subproceso procesará la tarea. Los subprocesos restantes del grupo están disponibles para manejar cualquier otra tarea que llegue mientras el primer subproceso está procesando. Cuando el primer subproceso ha terminado de procesar su tarea, se devuelve al grupo de subprocesos ociosos, listo para manejar una nueva tarea. Un grupo de subprocesos te permite procesar conexiones de manera concurrente, aumentando la rendimiento de tu servidor.

Limitaremos el número de subprocesos en el grupo a un número pequeño para protegernos de ataques DoS; si tuviéramos que nuestro programa creara un nuevo subproceso para cada solicitud que llegara, alguien que hiciera 10 millones de solicitudes a nuestro servidor podría causar estragos al consumir todos los recursos de nuestro servidor y detener el procesamiento de solicitudes.

En lugar de crear subprocesos ilimitados, entonces, tendremos un número fijo de subprocesos esperando en el grupo. Las solicitudes que llegan se envían al grupo para su procesamiento. El grupo mantendrá una cola de solicitudes entrantes. Cada uno de los subprocesos del grupo tomará una solicitud de esta cola, manejará la solicitud y luego solicitará otra solicitud a la cola. Con este diseño, podemos procesar hasta N solicitudes concurrentemente, donde N es el número de subprocesos. Si cada subproceso está respondiendo a una solicitud de larga duración, las solicitudes posteriores todavía pueden acumularse en la cola, pero hemos aumentado el número de solicitudes de larga duración que podemos manejar antes de llegar a ese punto.

Esta técnica es solo una de las muchas maneras de mejorar la rendimiento de un servidor web. Otras opciones que podrías explorar son el modelo fork/join, el modelo de E/S asíncrona de un solo subproceso y el modelo de E/S asíncrona multihilo. Si estás interesado en este tema, puedes leer más sobre otras soluciones e intentar implementarlas; con un lenguaje de bajo nivel como Rust, todas estas opciones son posibles.

Antes de comenzar a implementar un grupo de subprocesos, hablemos de cómo debería ser el uso del grupo. Cuando estás intentando diseñar código, escribir primero la interfaz del cliente puede ayudarte a guiar tu diseño. Escribe la API del código de manera que quede estructurada como quieres llamarla; luego implementa la funcionalidad dentro de esa estructura en lugar de implementar la funcionalidad y luego diseñar la API pública.

Similar a cómo usamos el desarrollo dirigido por pruebas en el proyecto del Capítulo 12, usaremos aquí el desarrollo dirigido por el compilador. Escribiremos el código que llama a las funciones que queremos, y luego veremos los errores del compilador para determinar qué debemos cambiar a continuación para que el código funcione. Antes de hacer eso, sin embargo, exploraremos la técnica que no vamos a usar como punto de partida.
