# トレイト境界を使って条件付きでメソッドを実装する

ジェネリック型パラメータを使った`impl`ブロックにトレイト境界を使うことで、指定されたトレイトを実装する型に対して条件付きでメソッドを実装することができます。たとえば、リスト10-15の`Pair<T>`型は常に`new`関数を実装して`Pair<T>`の新しいインスタンスを返します（「メソッドの定義」で思い出してください。`Self`は`impl`ブロックの型のエイリアスで、この場合`Pair<T>`です）。しかし、次の`impl`ブロックでは、`Pair<T>`は内部型`T`が比較を可能にする`PartialOrd`トレイトと印刷を可能にする`Display`トレイトの両方を実装している場合にのみ`cmp_display`メソッドを実装します。

ファイル名: `src/lib.rs`

```rust
use std::fmt::Display;

struct Pair<T> {
    x: T,
    y: T,
}

impl<T> Pair<T> {
    fn new(x: T, y: T) -> Self {
        Self { x, y }
    }
}

impl<T: Display + PartialOrd> Pair<T> {
    fn cmp_display(&self) {
        if self.x >= self.y {
            println!("The largest member is x = {}", self.x);
        } else {
            println!("The largest member is y = {}", self.y);
        }
    }
}
```

リスト10-15: トレイト境界に応じてジェネリック型に条件付きでメソッドを実装する

また、任意の型に対して、別のトレイトを実装している場合に条件付きでトレイトを実装することもできます。トレイト境界を満たす任意の型に対するトレイトの実装は、「ブランケット実装」と呼ばれ、Rust標準ライブラリで広く使用されています。たとえば、標準ライブラリは`Display`トレイトを実装する任意の型に対して`ToString`トレイトを実装しています。標準ライブラリの`impl`ブロックはこのコードに似ています。

```rust
impl<T: Display> ToString for T {
    --snip--
}
```

標準ライブラリにこのブランケット実装があるため、`Display`トレイトを実装する任意の型で`ToString`トレイトによって定義された`to_string`メソッドを呼び出すことができます。たとえば、整数は`Display`を実装しているため、このように整数を対応する`String`値に変換することができます。

```rust
let s = 3.to_string();
```

ブランケット実装は、「実装者」セクションのトレイトのドキュメントに表示されます。

トレイトとトレイト境界を使うことで、ジェネリック型パラメータを使って重複を減らしながらコードを書くことができますが、また、ジェネリック型が特定の動作を持つことをコンパイラに指定することもできます。その後、コンパイラはトレイト境界情報を使って、コードで使用されるすべての具体的な型が正しい動作を提供していることを確認することができます。動的型付け言語では、型に定義されていないメソッドを呼び出した場合、実行時にエラーが発生します。しかし、Rustはこれらのエラーをコンパイル時に移動させるため、コードが実行される前に問題を修正するように強制されます。また、実行時に動作をチェックするコードを書く必要がなくなります。なぜなら、コンパイル時に既にチェック済みだからです。これにより、ジェネリクスの柔軟性を犠牲にすることなくパフォーマンスが向上します。
