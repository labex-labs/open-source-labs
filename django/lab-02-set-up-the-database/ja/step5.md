# Django管理サイトの紹介

スタッフやクライアントにコンテンツを追加、変更、削除させるための管理サイトを生成するのは、創造性を必要としない退屈な作業です。そのため、Djangoはモデルの管理インターフェイスの作成を完全に自動化しています。

Djangoはニュース編集室の環境で書かれ、「コンテンツ提供者」と「一般公開」サイトの間に非常に明確な区別があります。サイト管理者はシステムを使ってニュース記事、イベント、スポーツのスコアなどを追加し、そのコンテンツが一般公開サイトに表示されます。Djangoは、サイト管理者がコンテンツを編集するための統一インターフェイスを作成する問題を解決します。

管理サイトはサイト訪問者には使用される意図がありません。サイト管理者向けのものです。

## 管理ユーザーの作成

まず、管理サイトにログインできるユーザーを作成する必要があります。次のコマンドを実行します。

```bash
python manage.py createsuperuser
```

好きなユーザー名を入力してEnterキーを押します。

```plaintext
ユーザー名: admin
```

次に、好きなメールアドレスを入力するように促されます。

```plaintext
メールアドレス: admin@example.com
```

最後のステップはパスワードを入力することです。パスワードを2回入力するように求められ、2回目は1回目の確認として使用されます。

```plaintext
パスワード: 12345678
パスワード (再入力): 12345678

このパスワードは一般的すぎます。
このパスワードは完全に数字のみです。
パスワード検証をバイパスしてユーザーを作成しますか？ [y/N]: y
スーパーユーザーが正常に作成されました。
```

## 開発サーバーを起動する

Django管理サイトはデフォルトで有効になっています。開発サーバーを起動して確認しましょう。

サーバーが実行されていない場合は、次のように起動します。

```bash
python manage.py runserver
```

次に、**VNC** タブでウェブブラウザを開き、ローカルドメインの "/admin/" にアクセスします。たとえば、`http://127.0.0.1:8000/admin/`。管理サイトのログイン画面が表示されるはずです。

![Django管理サイトのログイン画面](../assets/20230907-14-31-50-SvkJF8K8.png)

デフォルトでは `翻訳 </topics/i18n/translation>` が有効になっているため、`LANGUAGE_CODE` を設定すると、ログイン画面が指定された言語で表示されます（Djangoに適切な翻訳がある場合）。

## 管理サイトにログインする

次に、前の手順で作成したスーパーユーザーアカウントでログインしてみましょう。Django管理サイトのインデックスページが表示されるはずです。

![Django管理サイトのインデックスページ](../assets/admin02.png)

編集可能なコンテンツのいくつかの種類が表示されるはずです。グループとユーザーです。これらは、Djangoに付属する認証フレームワークである `django.contrib.auth` によって提供されています。

## 投票アプリを管理サイトで編集可能にする

では、私たちの投票アプリはどこにあるのでしょうか？管理サイトのインデックスページには表示されていません。

もう1つやることがあります。管理サイトに対して、`Question` オブジェクトに管理インターフェイスがあることを伝える必要があります。このために、`polls/admin.py` ファイルを開き、以下のように編集します。

```python
from django.contrib import admin

from.models import Question

admin.site.register(Question)
```

## 無料の管理機能を試す

`Question` を登録したので、Djangoはそれが管理サイトのインデックスページに表示されるべきであることを知っています。

![Django管理サイトのインデックスページ、今は投票アプリが表示されます](../assets/admin03t.png)

「質問」をクリックします。すると、質問の「変更一覧」ページに移動します。このページにはデータベース内のすべての質問が表示され、変更する質問を選ぶことができます。先ほど作成した「What's up?」の質問があります。

![投票アプリの変更一覧ページ](../assets/admin04t.png)

「What's up?」の質問をクリックして編集します。

![投票質問を編集する](../assets/20230907-14-33-49-XWeEgAXl.png)

ここで注目すべきことは以下の通りです。

- フォームは自動的に `Question` モデルから生成されます。
- 異なるモデルフィールド型（`~django.db.models.DateTimeField`、`~django.db.models.CharField`）は適切なHTML入力ウィジェットに対応しています。各フィールド型は、Django管理サイトで自身をどのように表示するかを知っています。
- 各 `~django.db.models.DateTimeField` には無料のJavaScriptショートカットがあります。日付には「今日」のショートカットとカレンダーポップアップがあり、時刻には「今」のショートカットと一般的に入力される時刻をリスト表示する便利なポップアップがあります。

ページの下部にはいくつかのオプションがあります。

- 保存 -- 変更を保存して、この種のオブジェクトの変更一覧ページに戻ります。
- 保存して続けて編集 -- 変更を保存して、このオブジェクトの管理ページを再読み込みします。
- 保存して新しいものを追加 -- 変更を保存して、この種のオブジェクト用の新しい空白のフォームを読み込みます。
- 削除 -- 削除確認ページを表示します。

「公開日付」の値が **基本的な投票アプリケーションの作成** で質問を作成した時刻と一致しない場合、おそらく `TIME_ZONE` 設定の正しい値を設定するのを忘れていることが原因です。設定を変更し、ページを再読み込みして、正しい値が表示されることを確認してください。

「今日」と「今」のショートカットをクリックして「公開日付」を変更します。その後、「保存して続けて編集」をクリックします。そして、右上の「履歴」をクリックします。このオブジェクトに対してDjango管理サイトを介して行われたすべての変更がタイムスタンプと変更を行ったユーザー名とともに一覧表示されるページが表示されます。

![質問オブジェクトの履歴ページ](../assets/admin06t.png)

モデルAPIに慣れ、管理サイトに慣れたら、**公開インターフェイスビューの作成** を読んで、投票アプリにさらに多くのビューを追加する方法を学びましょう。
