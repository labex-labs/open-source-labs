# 모델 활성화

모델 코드의 작은 부분은 Django 에게 많은 정보를 제공합니다. 이를 통해 Django 는 다음을 수행할 수 있습니다.

- 이 앱에 대한 데이터베이스 스키마 (`CREATE TABLE` 문) 를 생성합니다.
- `Question` 및 `Choice` 객체에 액세스하기 위한 Python 데이터베이스 액세스 API 를 생성합니다.

하지만 먼저 프로젝트에 `polls` 앱이 설치되었음을 알려야 합니다.

Django 앱은 "플러그 가능"합니다. 여러 프로젝트에서 앱을 사용할 수 있으며, 특정 Django 설치에 묶여 있을 필요가 없으므로 앱을 배포할 수 있습니다.

프로젝트에 앱을 포함하려면, `INSTALLED_APPS` 설정에 해당 구성 클래스에 대한 참조를 추가해야 합니다. `PollsConfig` 클래스는 `polls/apps.py` 파일에 있으므로, 점으로 구분된 경로는 `'polls.apps.PollsConfig'`입니다. `mysite/settings.py` 파일을 편집하고 해당 점으로 구분된 경로를 `INSTALLED_APPS` 설정에 추가합니다. 다음과 같이 표시됩니다.

```python
INSTALLED_APPS = [
    "polls.apps.PollsConfig",
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
]
```

이제 Django 는 `polls` 앱을 포함해야 함을 알고 있습니다. 다른 명령을 실행해 보겠습니다.

```bash
python manage.py makemigrations polls
```

다음과 유사한 내용이 표시됩니다.

```plaintext
Migrations for 'polls':
  polls/migrations/0001_initial.py
    - Create model Question
    - Create model Choice
```

`makemigrations`를 실행하면, 모델에 몇 가지 변경 사항을 적용했음을 (이 경우, 새로운 모델을 만들었음) Django 에게 알리고, 변경 사항을 *마이그레이션*으로 저장하려고 합니다.

마이그레이션은 Django 가 모델 (및 데이터베이스 스키마) 에 대한 변경 사항을 저장하는 방법입니다. 디스크의 파일입니다. 새 모델에 대한 마이그레이션을 읽을 수 있습니다. `polls/migrations/0001_initial.py` 파일입니다. 걱정하지 마세요. Django 가 마이그레이션을 만들 때마다 읽을 필요는 없지만, Django 가 변경 사항을 변경하는 방식을 수동으로 조정하려는 경우 사람이 편집할 수 있도록 설계되었습니다.

마이그레이션을 실행하고 데이터베이스 스키마를 자동으로 관리하는 명령이 있습니다. 이를 `migrate`라고 하며, 잠시 후에 살펴보겠습니다. 먼저, 해당 마이그레이션이 실행할 SQL 을 살펴보겠습니다. `sqlmigrate` 명령은 마이그레이션 이름을 가져와 해당 SQL 을 반환합니다.

```bash
python manage.py sqlmigrate polls 0001
```

다음과 유사한 내용이 표시됩니다 (가독성을 위해 형식을 변경했습니다).

```sql
BEGIN;
--
-- Create model Question
--
CREATE TABLE "polls_question" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "question_text" varchar(200) NOT NULL,
    "pub_date" timestamp with time zone NOT NULL
);
--
-- Create model Choice
--
CREATE TABLE "polls_choice" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "choice_text" varchar(200) NOT NULL,
    "votes" integer NOT NULL,
    "question_id" bigint NOT NULL
);
ALTER TABLE "polls_choice"
  ADD CONSTRAINT "polls_choice_question_id_c5b4b260_fk_polls_question_id"
    FOREIGN KEY ("question_id")
    REFERENCES "polls_question" ("id")
    DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "polls_choice_question_id_c5b4b260" ON "polls_choice" ("question_id");

COMMIT;
```

다음 사항에 유의하십시오.

- 정확한 출력은 사용 중인 데이터베이스에 따라 다릅니다. 위의 예는 PostgreSQL 에 대해 생성되었습니다.
- 테이블 이름은 앱 이름 (`polls`) 과 모델의 소문자 이름 (`question` 및 `choice`) 을 결합하여 자동으로 생성됩니다. (이 동작을 재정의할 수 있습니다.)
- 기본 키 (ID) 가 자동으로 추가됩니다. (이것도 재정의할 수 있습니다.)
- 관례적으로, Django 는 외래 키 필드 이름에 `"_id"`를 추가합니다. (예, 이것도 재정의할 수 있습니다.)
- 외래 키 관계는 `FOREIGN KEY` 제약 조건으로 명시적으로 설정됩니다. `DEFERRABLE` 부분에 대해 걱정하지 마십시오. 이는 PostgreSQL 에게 트랜잭션이 끝날 때까지 외래 키를 적용하지 않도록 지시하는 것입니다.
- 사용 중인 데이터베이스에 맞게 조정되므로, `auto_increment`(MySQL), `bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY`(PostgreSQL) 또는 `integer primary key autoincrement`(SQLite) 와 같은 데이터베이스별 필드 유형이 자동으로 처리됩니다. 필드 이름의 인용에도 동일하게 적용됩니다. 예를 들어, 큰따옴표 또는 작은따옴표를 사용합니다.
- `sqlmigrate` 명령은 실제로 데이터베이스에서 마이그레이션을 실행하지 않습니다. 대신, Django 가 필요하다고 생각하는 SQL 을 화면에 출력하여 Django 가 무엇을 할 것인지 확인하거나 변경 사항에 대한 SQL 스크립트가 필요한 데이터베이스 관리자가 있는 경우 유용합니다.

관심이 있다면, `python manage.py check <check>`를 실행할 수도 있습니다. 이는 마이그레이션을 수행하거나 데이터베이스를 건드리지 않고 프로젝트의 문제를 확인합니다.

이제 `migrate`를 다시 실행하여 데이터베이스에 해당 모델 테이블을 생성합니다.

```bash
python manage.py migrate
```

```plaintext
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Applying polls.0001_initial... OK
```

`migrate` 명령은 적용되지 않은 모든 마이그레이션 (Django 는 데이터베이스의 특수 테이블인 `django_migrations`를 사용하여 적용된 마이그레이션을 추적합니다) 을 가져와 데이터베이스에 대해 실행합니다. 본질적으로, 모델에 대한 변경 사항을 데이터베이스의 스키마와 동기화합니다.

마이그레이션은 매우 강력하며, 프로젝트를 개발하면서 데이터베이스나 테이블을 삭제하고 새 테이블을 만들 필요 없이 모델을 변경할 수 있습니다. 데이터를 잃지 않고 데이터베이스를 실시간으로 업그레이드하는 데 특화되어 있습니다. 튜토리얼의 뒷부분에서 더 자세히 다루겠지만, 지금은 모델 변경을 위한 세 단계 가이드를 기억하십시오.

- 모델을 변경합니다 (`models.py`에서).
- `python manage.py makemigrations <makemigrations>`를 실행하여 해당 변경 사항에 대한 마이그레이션을 생성합니다.
- `python manage.py migrate <migrate>`를 실행하여 해당 변경 사항을 데이터베이스에 적용합니다.

마이그레이션을 만들고 적용하는 별도의 명령이 있는 이유는 마이그레이션을 버전 관리 시스템에 커밋하고 앱과 함께 제공하기 때문입니다. 이는 개발을 더 쉽게 만들 뿐만 아니라 다른 개발자와 프로덕션에서도 사용할 수 있습니다.

`manage.py` 유틸리티가 수행할 수 있는 모든 정보는 `django-admin documentation </ref/django-admin>`을 참조하십시오.
