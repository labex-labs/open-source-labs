# Активация моделей

Этот небольшой кусок кода модели дает Django много информации. С его помощью Django может:

- Создать схему базы данных (`CREATE TABLE` инструкции) для этого приложения.
- Создать Python API для доступа к базы данных для доступа к объектам `Question` и `Choice`.

Но сначала нам нужно сообщить нашему проекту, что приложение `polls` установлено.

Приложения Django "плаггируемы": вы можете использовать приложение в нескольких проектах, и вы можете распространять приложения, потому что они не должны быть связаны с определенной установкой Django.

Чтобы включить приложение в наш проект, нам нужно добавить ссылку на его класс конфигурации в настройку `INSTALLED_APPS`. Класс `PollsConfig` находится в файле `polls/apps.py`, поэтому его полный путь с точками - `'polls.apps.PollsConfig'`. Отредактируйте файл `mysite/settings.py` и добавьте этот полный путь с точками в настройку `INSTALLED_APPS`. Он будет выглядеть так:

```python
INSTALLED_APPS = [
    "polls.apps.PollsConfig",
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
]
```

Теперь Django знает, что нужно включить приложение `polls`. Запустим еще одну команду:

```bash
python manage.py makemigrations polls
```

Вы должны увидеть что-то похожее на следующее:

```plaintext
Migrations for 'polls':
  polls/migrations/0001_initial.py
    - Create model Question
    - Create model Choice
```

Запустив `makemigrations`, вы сообщаете Django, что вы внесли некоторые изменения в ваши модели (в этом случае, вы создали новые) и что вы хотите, чтобы изменения были сохранены в виде _миграции_.

Миграции - это то, как Django хранит изменения в ваших моделях (и, следовательно, в схеме вашей базы данных) - это файлы на диске. Вы можете прочитать миграцию для вашей новой модели, если хотите; это файл `polls/migrations/0001_initial.py`. Не беспокойтесь, вам не нужно каждый раз читать их, когда Django создает их, но они предназначены для редактирования человеком, если вы хотите вручную настроить, как Django изменяет вещи.

Есть команда, которая будет выполнять миграции для вас и автоматически управлять схемой вашей базы данных - это команда `migrate`, и мы поговорим об этом сейчас - но сначала давайте посмотрим, какой SQL будет выполняться при этой миграции. Команда `sqlmigrate` принимает имена миграций и возвращает их SQL:

```bash
python manage.py sqlmigrate polls 0001
```

Вы должны увидеть что-то похожее на следующее (мы отформатировали его для удобства чтения):

```sql
BEGIN;
--
-- Create model Question
--
CREATE TABLE "polls_question" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "question_text" varchar(200) NOT NULL,
    "pub_date" timestamp with time zone NOT NULL
);
--
-- Create model Choice
--
CREATE TABLE "polls_choice" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "choice_text" varchar(200) NOT NULL,
    "votes" integer NOT NULL,
    "question_id" bigint NOT NULL
);
ALTER TABLE "polls_choice"
  ADD CONSTRAINT "polls_choice_question_id_c5b4b260_fk_polls_question_id"
    FOREIGN KEY ("question_id")
    REFERENCES "polls_question" ("id")
    DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "polls_choice_question_id_c5b4b260" ON "polls_choice" ("question_id");

COMMIT;
```

Обратите внимание на следующее:

- Точный вывод может отличаться в зависимости от используемой вами базы данных. Пример выше сгенерирован для PostgreSQL.
- Имена таблиц автоматически генерируются путем объединения имени приложения (`polls`) и нижнего регистра имени модели - `question` и `choice`. (Вы можете переопределить это поведение.)
- Первичные ключи (идентификаторы) добавляются автоматически. (Вы также можете переопределить это.)
- По соглашению Django добавляет `"_id"` к имени поля внешнего ключа. (Да, вы также можете переопределить это.)
- Связь внешнего ключа явно задается с помощью ограничения `FOREIGN KEY`. Не беспокойтесь о частях `DEFERRABLE`; это говорит PostgreSQL не накладывать ограничение внешнего ключа до конца транзакции.
- Она настроена под вашу используемую базу данных, поэтому такие специфические для базы данных типы полей, как `auto_increment` (MySQL), `bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY` (PostgreSQL) или `integer primary key autoincrement` (SQLite), обрабатываются для вас автоматически. То же относится к кавычкам имен полей - например, к использованию двойных или одинарных кавычек.
- Команда `sqlmigrate` на самом деле не выполняет миграцию на вашей базе данных - вместо этого она выводит ее на экран, чтобы вы могли увидеть, какой SQL Django считает необходимым. Это полезно для проверки того, что Django собирается сделать, или если у вас есть администраторы базы данных, которым требуются SQL-скрипты для изменений.

Если вы заинтересованы, вы также можете запустить `python manage.py check <check>`; это проверяет наличие любых проблем в вашем проекте без создания миграций или изменения базы данных.

Теперь запустите `migrate` еще раз, чтобы создать эти таблицы моделей в вашей базе данных:

```bash
python manage.py migrate
```

```plaintext
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Applying polls.0001_initial... OK
```

Команда `migrate` берет все миграции, которые еще не были применены (Django отслеживает, какие из них применены, с помощью специальной таблицы в вашей базе данных, называемой `django_migrations`) и выполняет их для вашей базы данных - по сути, синхронизируя изменения, которые вы внесли в ваши модели, с схемой в базе данных.

Миграции очень мощны и позволяют вам изменять ваши модели по мере развития вашего проекта, не удаляя при этом вашу базу данных или таблицы и не создавая новые - она специализируется на обновлении вашей базы данных в реальном времени без потери данных. Мы рассмотрим их более подробно в более поздней части этого туториала, но пока помните три шага по изменению моделей:

- Измените ваши модели (в `models.py`).
- Запустите `python manage.py makemigrations <makemigrations>`, чтобы создать миграции для этих изменений
- Запустите `python manage.py migrate <migrate>`, чтобы применить эти изменения к базе данных.

Причина, по которой есть отдельные команды для создания и применения миграций, заключается в том, что вы будете коммитить миграции в свою систему контроля версий и распространять их вместе с вашим приложением; они не только облегчают ваше развитие, но и могут быть использованы другими разработчиками и в продакшене.

Читайте `документацию по django-admin </ref/django-admin>` для получения полной информации о том, что может делать утилита `manage.py`.
