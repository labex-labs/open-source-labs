# Modelle aktivieren

Dieser kleine Codeausschnitt für die Modelle liefert Django eine Menge Informationen. Mit ihm kann Django:

- Ein Datenbank-Schema (`CREATE TABLE`-Anweisungen) für diese App erstellen.
- Eine Python-Datenbank-Zugangs-API für das Zugreifen auf `Question`- und `Choice`-Objekte erstellen.

Aber zunächst müssen wir unserem Projekt mitteilen, dass die `polls`-App installiert ist.

Django-Apps sind "plugbar": Sie können eine App in mehreren Projekten verwenden und Apps verteilen, da sie nicht an eine bestimmte Django-Installation gebunden sein müssen.

Um die App in unserem Projekt zu integrieren, müssen wir in der `INSTALLED_APPS`-Einstellung einen Verweis auf ihre Konfigurationsklasse hinzufügen. Die `PollsConfig`-Klasse befindet sich in der Datei `polls/apps.py`, so dass ihr punktierter Pfad `'polls.apps.PollsConfig'` ist. Bearbeiten Sie die Datei `mysite/settings.py` und fügen Sie diesen punktierten Pfad zur `INSTALLED_APPS`-Einstellung hinzu. Es sollte so aussehen:

```python
INSTALLED_APPS = [
    "polls.apps.PollsConfig",
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
]
```

Jetzt weiß Django, die `polls`-App einzuschließen. Führen wir einen weiteren Befehl aus:

```bash
python manage.py makemigrations polls
```

Sie sollten etwas Ähnliches wie Folgendes sehen:

```plaintext
Migrations for 'polls':
  polls/migrations/0001_initial.py
    - Create model Question
    - Create model Choice
```

Durch Ausführen von `makemigrations` sagen Sie Django, dass Sie Änderungen an Ihren Modellen vorgenommen haben (in diesem Fall haben Sie neue Modelle erstellt) und dass Sie die Änderungen als _Migration_ speichern möchten.

Migrationen sind die Art und Weise, wie Django Änderungen an Ihren Modellen (und damit Ihrem Datenbank-Schema) speichert - es sind Dateien auf der Festplatte. Sie können die Migration für Ihr neues Modell lesen, wenn Sie möchten; es ist die Datei `polls/migrations/0001_initial.py`. Machen Sie sich keine Sorgen, Sie müssen sie nicht jedes Mal lesen, wenn Django eine erstellt, aber sie sind so gestaltet, dass Sie sie manuell bearbeiten können, falls Sie möchten, wie Django Dinge ändert.

Es gibt einen Befehl, der die Migrationen für Sie ausführt und Ihr Datenbank-Schema automatisch verwaltet - das heißt `migrate`, und wir kommen gleich darauf zu sprechen - aber zunächst schauen wir uns an, welche SQL-Anweisungen diese Migration ausführen würde. Der `sqlmigrate`-Befehl nimmt Migrationsnamen und gibt ihre SQL zurück:

```bash
python manage.py sqlmigrate polls 0001
```

Sie sollten etwas Ähnliches wie Folgendes sehen (wir haben es für die Lesbarkeit umformatert):

```sql
BEGIN;
--
-- Create model Question
--
CREATE TABLE "polls_question" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "question_text" varchar(200) NOT NULL,
    "pub_date" timestamp with time zone NOT NULL
);
--
-- Create model Choice
--
CREATE TABLE "polls_choice" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "choice_text" varchar(200) NOT NULL,
    "votes" integer NOT NULL,
    "question_id" bigint NOT NULL
);
ALTER TABLE "polls_choice"
  ADD CONSTRAINT "polls_choice_question_id_c5b4b260_fk_polls_question_id"
    FOREIGN KEY ("question_id")
    REFERENCES "polls_question" ("id")
    DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "polls_choice_question_id_c5b4b260" ON "polls_choice" ("question_id");

COMMIT;
```

Beachten Sie Folgendes:

- Die genaue Ausgabe variiert je nach verwendeter Datenbank. Das obige Beispiel ist für PostgreSQL generiert.
- Tabellennamen werden automatisch generiert, indem der Name der App (`polls`) und der Kleinbuchstabenname des Modells kombiniert werden - `question` und `choice`. (Sie können dieses Verhalten überschreiben.)
- Primärschlüssel (IDs) werden automatisch hinzugefügt. (Sie können dies ebenfalls überschreiben.)
- Konventionell fügt Django `"_id"` zum Fremdschlüsselfeldnamen hinzu. (Ja, Sie können dies ebenfalls überschreiben.)
- Die Fremdschlüsselbeziehung wird durch eine `FOREIGN KEY`-Einschränkung explizit gemacht. Machen Sie sich keine Sorgen um die `DEFERRABLE`-Teile; es sagt PostgreSQL, die Fremdschlüsselbeziehung erst bis zum Ende der Transaktion zu überprüfen.
- Es ist auf die von Ihnen verwendete Datenbank zugeschnitten, so dass datenbankabhängige Feldtypen wie `auto_increment` (MySQL), `bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY` (PostgreSQL) oder `integer primary key autoincrement` (SQLite) automatisch für Sie behandelt werden. Dasselbe gilt für die Anführungszeichen von Feldnamen - z.B. Verwendung von doppelten oder einfachen Anführungszeichen.
- Der `sqlmigrate`-Befehl führt die Migration auf Ihrer Datenbank tatsächlich nicht aus - stattdessen druckt er sie auf dem Bildschirm aus, damit Sie sehen können, welche SQL-Anweisungen Django benötigt. Es ist nützlich, um zu überprüfen, was Django machen wird, oder wenn Sie Datenbankadministratoren haben, die SQL-Skripte für Änderungen benötigen.

Wenn Sie interessiert sind, können Sie auch `python manage.py check <check>` ausführen; dies überprüft das Projekt auf Probleme, ohne Migrationen zu erstellen oder die Datenbank zu berühren.

Jetzt führen Sie `migrate` erneut aus, um diese Modelltabellen in Ihrer Datenbank zu erstellen:

```bash
python manage.py migrate
```

```plaintext
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Applying polls.0001_initial... OK
```

Der `migrate`-Befehl nimmt alle Migrationen, die noch nicht angewendet wurden (Django verfolgt, welche angewendet wurden, mithilfe einer speziellen Tabelle in Ihrer Datenbank namens `django_migrations`) und führt sie auf Ihrer Datenbank aus - im Wesentlichen synchronisiert er die Änderungen, die Sie an Ihren Modellen vorgenommen haben, mit dem Schema in der Datenbank.

Migrationen sind sehr leistungsfähig und ermöglichen es Ihnen, Ihre Modelle im Laufe der Entwicklung Ihres Projekts zu ändern, ohne dass Sie Ihre Datenbank oder Tabellen löschen und neu erstellen müssen - sie sind speziell darauf ausgelegt, Ihre Datenbank live zu aktualisieren, ohne Daten zu verlieren. Wir werden sie in einem späteren Teil des Tutorials genauer behandeln, aber für jetzt halten Sie sich an die drei Schritte, um Änderungen an Modellen vorzunehmen:

- Ändern Sie Ihre Modelle (in `models.py`).
- Führen Sie `python manage.py makemigrations <makemigrations>` aus, um Migrationen für diese Änderungen zu erstellen.
- Führen Sie `python manage.py migrate <migrate>` aus, um diese Änderungen auf die Datenbank anzuwenden.

Der Grund, warum es separate Befehle gibt, um Migrationen zu erstellen und anzuwenden, ist, dass Sie Migrationen in Ihr Versionskontrollsystem committen und sie mit Ihrer App ausliefern können; sie erleichtern nicht nur Ihre Entwicklung, sondern sind auch für andere Entwickler und in der Produktion verwendbar.

Lesen Sie die `django-admin-Dokumentation </ref/django-admin>`, um vollständige Informationen über die Funktionen der `manage.py`-Hilfsprogramme zu erhalten.
